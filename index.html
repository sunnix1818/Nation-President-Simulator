<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nation President Simulator - MAPPA MONDIALE REALISTICA</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e); 
            color:#fff; font-family:'Segoe UI',Arial,sans-serif; overflow:hidden;
        }
        canvas { display:block; cursor: crosshair; }
        #ui { 
            position:absolute; top:15px; left:15px; 
            background: rgba(0,0,0,0.95); padding:25px; border-radius:20px; 
            border: 3px solid #4a90e2; backdrop-filter: blur(15px);
            box-shadow: 0 10px 40px rgba(74,144,226,0.4); min-width: 420px;
        }
        #title { 
            color:#4a90e2; font-size:28px; font-weight:bold; text-align:center; 
            margin-bottom:18px; text-shadow: 0 0 20px #4a90e2; letter-spacing: 2px;
        }
        button { 
            background: linear-gradient(45deg, #4a90e2, #357abd); color:white; 
            border:none; padding:14px 22px; margin:5px; border-radius:10px; 
            cursor:pointer; font-weight:bold; transition: all 0.3s; font-size:14px;
            box-shadow: 0 5px 20px rgba(74,144,226,0.4);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(74,144,226,0.6); }
        button.danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        button.success { background: linear-gradient(45deg, #27ae60, #229954); }
        button.neutral { background: linear-gradient(45deg, #f39c12, #e67e22); }
        #stats { 
            font-size:17px; line-height:1.7; margin:18px 0; background: rgba(255,255,255,0.08); 
            padding:20px; border-radius:12px; border: 1px solid rgba(74,144,226,0.3);
        }
        .stat-bar { width:100%; height:12px; background:rgba(255,255,255,0.12); border-radius:6px; margin:6px 0; overflow:hidden; }
        .stat-fill { height:100%; transition: width 0.6s ease; border-radius:6px; }
        #news { 
            position:absolute; bottom:20px; right:20px; width:450px; height:350px; 
            overflow-y:auto; background:rgba(0,0,0,0.95); padding:25px; border-radius:20px;
            border: 3px solid #f39c12; font-size:15px; line-height:1.6;
        }
        .news-item { margin-bottom:15px; padding:15px; background:rgba(243,156,18,0.2); border-radius:12px; border-left: 5px solid #f39c12; }
        .news-victory { background: rgba(46,204,113,0.4) !important; border-left-color: #27ae60 !important; }
        select { background:#2c3e50; color:white; border:2px solid #4a90e2; padding:12px; border-radius:8px; margin:8px; font-size:14px; }
        #minimap { position:absolute; bottom:20px; left:20px; width:200px; height:120px; background:rgba(0,0,0,0.8); border-radius:15px; border:2px solid #9b59b6; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <canvas id="minimap"></canvas>
    
    <div id="ui">
        <div id="title">ğŸŒ PRESIDENT SIMULATOR 2026</div>
        <div style="font-size:20px; margin-bottom:12px; text-align:center;">
            <span id="flag">ğŸ‡®ğŸ‡¹</span> <span id="nationName">Italia</span>
        </div>
        
        <div id="stats">
            ğŸ’° <strong>GDP:</strong> $<span id="gdp">2100</span>B 
            <div class="stat-bar"><div id="gdpBar" class="stat-fill" style="background:linear-gradient(90deg,#27ae60,#2ecc71,#27ae60);width:35%"></div></div>
            
            ğŸ‘¥ <strong>Popolazione:</strong> <span id="pop">60</span>M 
            <div class="stat-bar"><div id="popBar" class="stat-fill" style="background:linear-gradient(90deg,#3498db,#5dade2);width:25%"></div></div>
            
            ğŸ‘ <strong>Approvazione:</strong> <span id="approval">58</span>% 
            <div class="stat-bar"><div id="approvalBar" class="stat-fill" style="background:linear-gradient(90deg,#f39c12,#e67e22);width:58%"></div></div>
            
            âš”ï¸ <strong>Militare:</strong> <span id="military">95</span> 
            <div class="stat-bar"><div id="militaryBar" class="stat-fill" style="background:linear-gradient(90deg,#e74c3c,#c0392b);width:16%"></div></div>
            
            ğŸ¤ <strong>Alleanze:</strong> <span id="diplo">0</span> 
            <div class="stat-bar"><div id="diploBar" class="stat-fill" style="background:linear-gradient(90deg,#9b59b6,#8e44ad);width:0%"></div></div>
            
            ğŸ’¸ <strong>Debito:</strong> $<span id="debt">2850</span>B
            <div style="font-size:13px; color:#f39c12; margin-top:10px;">
                ğŸ“Š Quota GDP Mondiale: <span id="worldShare">4.2</span>%
            </div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:20px 0;">
            <button onclick="selectNationRandom()" style="grid-column:span 2; background:linear-gradient(45deg,#9b59b6,#8e44ad)">
                ğŸ² Cambia Nazione
            </button>
            
            <button onclick="setTaxesLow()">ğŸ’¸ Tasse Basse</button>
            <button onclick="setTaxesHigh()">ğŸ’° Tasse Alte</button>
            
            <button class="success" onclick="buildInfrastructure()">ğŸ—ï¸ Infrastrutture</button>
            <button class="success" onclick="boostTrade()">ğŸŒ Commercio</button>
            
            <button class="danger" onclick="recruitMilitary()">âš”ï¸ Esercito</button>
            <button class="neutral" onclick="makeAlliance()">ğŸ¤ Alleanza</button>
            
            <button class="danger" onclick="declareWar()">ğŸ’¥ Dichiarare Guerra</button>
            <button onclick="randomEvent()">ğŸ² Evento Casuale</button>
            
            <button onclick="nextMonth()" style="grid-column:span 2; background:linear-gradient(45deg,#27ae60,#229954); font-size:16px">
                â© PROSSIMO MESE
            </button>
        </div>

        <div style="text-align:center">
            <select id="winMode">
                <option>ğŸŒ Dominio Assoluto (80% GDP mondiale)</option>
                <option>ğŸ’ Superpotenza (GDP #1 + 85% approv.)</option>
                <option>â³ LongevitÃ  (2038)</option>
            </select>
        </div>
        <div style="margin-top:15px; text-align:center; font-size:13px;">
            <button onclick="saveGame()">ğŸ’¾ Salva Partita</button>
            <button onclick="loadGame()">ğŸ“‚ Carica Partita</button>
            <button onclick="togglePause()" id="pauseBtn">â¸ï¸ Pausa</button>
        </div>
    </div>

    <div id="news"></div>

    <script>
        // CANVAS PRINCIPALE + MINIMAP
        const canvas = document.getElementById('canvas');
        const minimap = document.getElementById('minimap');
        const ctx = canvas.getContext('2d');
        const mctx = minimap.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        minimap.width = 200; minimap.height = 120;

        // âœ… POSIZIONI REALI MAPPA MONDIALE (coordinate precise)
        const nationsData = {
            'USA':        { pop:340, gdp:28500, mil:520, debt:35000, app:48, flag:'ğŸ‡ºğŸ‡¸', color:'#ff2222', x:0.18, y:0.42, continent:'NA', size:85 },
            'Canada':     { pop:40, gdp:2200, mil:45, debt:1800, app:72, flag:'ğŸ‡¨ğŸ‡¦', color:'#ff0000', x:0.16, y:0.32, continent:'NA', size:35 },
            'Messico':    { pop:130, gdp:1500, mil:65, debt:650, app:45, flag:'ğŸ‡²ğŸ‡½', color:'#32cd32', x:0.22, y:0.52, continent:'NA', size:28 },
            'Brasile':    { pop:216, gdp:2200, mil:85, debt:1600, app:48, flag:'ğŸ‡§ğŸ‡·', color:'#00ff00', x:0.28, y:0.75, continent:'SA', size:42 },
            'Argentina':  { pop:46, gdp:650, mil:45, debt:400, app:50, flag:'ğŸ‡¦ğŸ‡·', color:'#40e0d0', x:0.30, y:0.82, continent:'SA', size:22 },
            
            'UK':         { pop:68, gdp:3400, mil:95, debt:3100, app:52, flag:'ğŸ‡¬ğŸ‡§', color:'#8b0000', x:0.28, y:0.48, continent:'EU', size:32 },
            'Irlanda':    { pop:5, gdp:550, mil:10, debt:300, app:65, flag:'ğŸ‡®ğŸ‡ª', color:'#00ff00', x:0.27, y:0.46, continent:'EU', size:18 },
            'Francia':    { pop:68, gdp:3100, mil:115, debt:3200, app:54, flag:'ğŸ‡«ğŸ‡·', color:'#ffff00', x:0.34, y:0.54, continent:'EU', size:35 },
            'Spagna':     { pop:47, gdp:1600, mil:55, debt:1700, app:55, flag:'ğŸ‡ªğŸ‡¸', color:'#ff1493', x:0.35, y:0.60, continent:'EU', size:28 },
            'Portogallo': { pop:10, gdp:300, mil:20, debt:300, app:58, flag:'ğŸ‡µğŸ‡¹', color:'#4169e1', x:0.33, y:0.62, continent:'EU', size:20 },
            'Italia':     { pop:60, gdp:2100, mil:95, debt:2850, app:58, flag:'ğŸ‡®ğŸ‡¹', color:'#00ff41', x:0.42, y:0.58, continent:'EU', size:38 },
            'Germania':   { pop:84, gdp:4400, mil:85, debt:2800, app:62, flag:'ğŸ‡©ğŸ‡ª', color:'#ffd700', x:0.38, y:0.48, continent:'EU', size:40 },
            'Olanda':     { pop:18, gdp:1100, mil:30, debt:550, app:68, flag:'ğŸ‡³ğŸ‡±', color:'#ffa500', x:0.37, y:0.51, continent:'EU', size:25 },
            'Belgio':     { pop:12, gdp:650, mil:25, debt:600, app:60, flag:'ğŸ‡§ğŸ‡ª', color:'#0000ff', x:0.36, y:0.52, continent:'EU', size:22 },
            'Svezia':     { pop:10, gdp:650, mil:25, debt:300, app:75, flag:'ğŸ‡¸ğŸ‡ª', color:'#00bfff', x:0.33, y:0.42, continent:'EU', size:24 },
            'Norvegia':   { pop:5, gdp:500, mil:15, debt:200, app:78, flag:'ğŸ‡³ğŸ‡´', color:'#ff69b4', x:0.32, y:0.38, continent:'EU', size:20 },
            'Finlandia':  { pop:6, gdp:300, mil:20, debt:250, app:70, flag:'ğŸ‡«ğŸ‡®', color:'#ff4500', x:0.35, y:0.40, continent:'EU', size:20 },
            'Danimarca':  { pop:6, gdp:400, mil:15, debt:200, app:72, flag:'ğŸ‡©ğŸ‡°', color:'#00ff88', x:0.34, y:0.44, continent:'EU', size:18 },
            'Polonia':    { pop:38, gdp:800, mil:80, debt:400, app:55, flag:'ğŸ‡µğŸ‡±', color:'#ff0000', x:0.44, y:0.47, continent:'EU', size:28 },
            'Grecia':     { pop:10, gdp:250, mil:40, debt:450, app:50, flag:'ğŸ‡¬ğŸ‡·', color:'#00ced1', x:0.46, y:0.56, continent:'EU', size:22 },
            
            'Russia':     { pop:144, gdp:1850, mil:320, debt:650, app:72, flag:'ğŸ‡·ğŸ‡º', color:'#4169e1', x:0.65, y:0.35, continent:'EU', size:55 },
            'Turchia':    { pop:85, gdp:1200, mil:150, debt:500, app:60, flag:'ğŸ‡¹ğŸ‡·', color:'#ff4500', x:0.52, y:0.54, continent:'AS', size:35 },
            
            'Giappone':   { pop:123, gdp:5200, mil:70, debt:9500, app:68, flag:'ğŸ‡¯ğŸ‡µ', color:'#ff1493', x:0.95, y:0.42, continent:'AS', size:45 },
            'CoreaSud':   { pop:52, gdp:1900, mil:75, debt:850, app:78, flag:'ğŸ‡°ğŸ‡·', color:'#00bfff', x:0.92, y:0.47, continent:'AS', size:32 },
            'Cina':       { pop:1410, gdp:19500, mil:450, debt:12000, app:92, flag:'ğŸ‡¨ğŸ‡³', color:'#ff8c00', x:0.88, y:0.52, continent:'AS', size:75 },
            'India':      { pop:1420, gdp:3800, mil:180, debt:2800, app:65, flag:'ğŸ‡®ğŸ‡³', color:'#ff6600', x:0.82, y:0.68, continent:'AS', size:52 },
            'ArabiaSaudita':{ pop:36, gdp:1100, mil:90, debt:300, app:70, flag:'ğŸ‡¸ğŸ‡¦', color:'#b8860b', x:0.72, y:0.62, continent:'AS', size:30 },
            'Iran':       { pop:89, gdp:500, mil:120, debt:200, app:65, flag:'ğŸ‡®ğŸ‡·', color:'#8b0000', x:0.62, y:0.58, continent:'AS', size:28 },
            'Egitto':     { pop:110, gdp:450, mil:120, debt:200, app:55, flag:'ğŸ‡ªğŸ‡¬', color:'#ff4500', x:0.58, y:0.66, continent:'AF', size:30 },
            
            'Australia':  { pop:26, gdp:1700, mil:40, debt:900, app:75, flag:'ğŸ‡¦ğŸ‡º', color:'#4169e1', x:0.92, y:0.88, continent:'OC', size:35 }
        };

        // GIOCO
        let game = {
            year: 2026, month: 1, day: 15,
            playerNation: 'Italia',
            nations: JSON.parse(JSON.stringify(nationsData)),
            player: {...nationsData['Italia']},
            diplomacy: {},
            alliances: new Set(),
            enemies: new Set(),
            news: [],
            winCondition: 'Dominio Assoluto',
            gameSpeed: 1/30,
            paused: false,
            camera: { x: 0, y: 0, zoom: 1.2 },
            selectedNation: null,
            totalWorldGDP: 0
        };

        // INIZIALIZZAZIONE
        Object.keys(game.nations).forEach(name => {
            game.diplomacy[name] = name === game.playerNation ? 'player' : 'neutral';
            game.totalWorldGDP += game.nations[name].gdp;
        });

        // UI UPDATE
        function updateUI() {
            document.getElementById('nationName').textContent = game.playerNation;
            document.getElementById('flag').textContent = game.nations[game.playerNation].flag;
            document.getElementById('gdp').textContent = Math.floor(game.player.gdp).toLocaleString();
            document.getElementById('pop').textContent = Math.floor(game.player.pop).toLocaleString();
            document.getElementById('approval').textContent = Math.floor(game.player.app);
            document.getElementById('military').textContent = Math.floor(game.player.mil);
            document.getElementById('diplo').textContent = game.alliances.size;
            document.getElementById('debt').textContent = Math.floor(game.player.debt).toLocaleString();
            document.getElementById('worldShare').textContent = (game.player.gdp/game.totalWorldGDP*100).toFixed(1);
            
            // Stat bar updates
            ['gdp','pop','approval','military','diplo'].forEach(stat => {
                const bar = document.getElementById(stat + 'Bar');
                const value = game.player[stat === 'approval' ? 'app' : stat];
                const max = stat === 'gdp' ? 40000 : stat === 'pop' ? 1500 : stat === 'approval' ? 100 : stat === 'military' ? 600 : 20;
                bar.style.width = `${Math.min(value/max*100, 100)}%`;
            });
            
            document.getElementById('pauseBtn').textContent = game.paused ? 'â–¶ï¸ Riprendi' : 'â¸ï¸ Pausa';
        }

        // FUNZIONI GIOCO MIGLIORATE
        function selectNationRandom() {
            const choices = Object.keys(game.nations).filter(n => n !== game.playerNation);
            const choice = choices[Math.floor(Math.random() * choices.length)];
            game.playerNation = choice;
            game.player = {...game.nations[choice]};
            game.selectedNation = choice;
            Object.keys(game.diplomacy).forEach(n => game.diplomacy[n] = n === choice ? 'player' : 'neutral');
            updateUI();
            addNews(`ğŸ‘‘ <strong>Nuova Presidenza:</strong> ${choice} ${game.nations[choice].flag}`, 'victory');
        }

        function setTaxesLow() { setTaxes(0.25, 'Basse'); }
        function setTaxesHigh() { setTaxes(0.65, 'Alte'); }
        function setTaxes(rate, label) {
            const oldGDP = game.player.gdp;
            const multiplier = 1 + (rate - 0.4) * 0.20;
            game.player.gdp *= multiplier;
            game.player.app += rate < 0.3 ? 12 : rate > 0.6 ? -18 : 3;
            game.player.debt += rate * game.player.gdp * 0.15;
            game.player.app = Math.max(0, Math.min(100, game.player.app));
            addNews(`ğŸ’¸ Tasse ${label} (${Math.round(rate*100)}%): GDP ${Math.floor(oldGDP)}B â†’ ${Math.floor(game.player.gdp)}B`);
        }

        function buildInfrastructure() {
            const gain = 100 + Math.random() * 60;
            game.player.gdp += gain;
            game.player.debt += 180;
            game.player.app += 12;
            addNews(`ğŸ—ï¸ <strong>Infrastrutture completate!</strong> +${gain} GDP, +12% approvazione`);
        }

        function boostTrade() {
            const bonus = 70 + game.alliances.size * 20;
            game.player.gdp += bonus;
            game.player.app += 6;
            addNews(`ğŸŒ <strong>Commercio internazionale:</strong> +${bonus} GDP (${game.alliances.size} alleati)`);
        }

        function recruitMilitary() {
            const troops = 35 + Math.random() * 25;
            const cost = 55 + game.player.mil * 0.2;
            game.player.mil += troops;
            game.player.gdp -= cost;
            game.player.app -= 6;
            addNews(`âš”ï¸ Reclutamento: +${Math.floor(troops)} truppe (-${Math.floor(cost)} GDP)`);
        }

        function makeAlliance() {
            const targets = Object.keys(game.nations).filter(n => n !== game.playerNation && game.diplomacy[n] === 'neutral');
            if (!targets.length) return addNews('âŒ Nessun candidato disponibile per alleanze');
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'ally';
            game.alliances.add(target);
            game.player.gdp += 40;
            addNews(`ğŸ¤ <strong>Alleanza firmata con ${target}!</strong> +40 GDP`, 'victory');
        }

        function declareWar() {
            const targets = Object.keys(game.nations).filter(n => n !== game.playerNation && game.diplomacy[n] !== 'enemy');
            if (!targets.length) return addNews('âŒ Nessun bersaglio disponibile');
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'enemy';
            game.enemies.add(target);
            
            const powerRatio = game.player.mil / (game.player.mil + game.nations[target].mil);
            if (Math.random() < powerRatio * 0.8) {
                const loot = game.nations[target].gdp * 0.4;
                game.player.gdp += loot;
                game.nations[target].gdp *= 0.6;
                game.player.mil += 20;
                addNews(`âœ… <strong>VITTORIA contro ${target}!</strong> +${Math.floor(loot)}B GDP conquistato`, 'victory');
            } else {
                game.player.gdp *= 0.8;
                game.player.mil *= 0.7;
                game.player.app -= 20;
                addNews(`ğŸ’¥ <strong>Sconfitta contro ${target}!</strong> Perdite catastrofiche`);
            }
        }

        function randomEvent() {
            const events = [
                { text: 'ğŸš€ <strong>Boom tecnologico!</strong> +350 GDP', effect: () => game.player.gdp += 350 },
                { text: 'ğŸŒªï¸ <strong>Disastro naturale!</strong> -150 GDP', effect: () => game.player.gdp -= 150 },
                { text: 'ğŸ“ˆ <strong>Crescita economica!</strong> +120 GDP', effect: () => game.player.gdp += 120 },
                { text: 'ğŸ“° <strong>Scandalo politico!</strong> -25% approvazione', effect: () => game.player.app = Math.max(0, game.player.app - 25) },
                { text: 'ğŸ‘¶ <strong>Boom demografico!</strong> +4M popolazione', effect: () => game.player.pop += 4 },
                { text: 'ğŸ’ <strong>Petrolio scoperto!</strong> +500 GDP', effect: () => game.player.gdp += 500 },
                { text: 'âš½ <strong>Mondiale vinto!</strong> +20% approvazione', effect: () => game.player.app = Math.min(100, game.player.app + 20) },
                { text: 'ğŸ’¸ <strong>Crisi debito!</strong> +3000B debito', effect: () => game.player.debt += 3000 }
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            event.effect();
            addNews(event.text);
        }

        function nextMonth() {
            game.month++;
            if (game.month > 12) { game.year++; game.month = 1; randomEvent(); }
            updateAI();
            checkVictory();
            updateUI();
            addNews(`ğŸ“… <strong>Mese ${game.month}/${game.year}</strong> - Economia aggiornata`);
        }

        function updateAI() {
            Object.entries(game.nations).forEach(([name, nation]) => {
                if (name === game.playerNation) return;
                nation.gdp *= 1.015;
                nation.mil *= 1.004;
                nation.pop *= 1.001;
                nation.app += (Math.random() - 0.5) * 3;
                game.totalWorldGDP += nation.gdp * 0.015;
            });
        }

        function checkVictory() {
            const playerShare = game.player.gdp / game.totalWorldGDP;
            const isTopGDP = game.player.gdp === Math.max(...Object.values(game.nations).map(n => n.gdp));
            
            if (playerShare > 0.8) {
                addNews(`ğŸ‰ <strong>VITTORIA ASSOLUTA! DOMINIO MONDIALE!</strong>`, 'victory');
                alert(`ğŸ† CONGRATULAZIONI! Controlli l'80% del GDP mondiale!\nPunteggio: ${Math.floor(game.year*100 + game.month*10 + game.player.app)}`);
            } else if (isTopGDP && game.player.app > 85) {
                addNews(`ğŸ’ <strong>SUPERPOTENZA GLOBALE!</strong> #1 GDP + 85% approvazione`, 'victory');
            }
        }

        function addNews(msg, type = '') {
            game.news.unshift(`[${game.year}-${String(game.month).padStart(2,'0')}] ${msg}`);
            if (game.news.length > 15) game.news.pop();
            const newsDiv = document.getElementById('news');
            newsDiv.innerHTML = game.news.map((n, i) => 
                `<div class="news-item ${type && i === 0 ? 'news-victory' : ''}">${n}</div>`
            ).join('');
            newsDiv.scrollTop = 0;
        }

        function togglePause() {
            game.paused = !game.paused;
            updateUI();
        }

        // RENDER MAPPA MONDIALE REALISTICA
        function renderWorldMap() {
            const w = canvas.width / game.camera.zoom;
            const h = canvas.height / game.camera.zoom;
            
            // OCEANO
            const oceanGradient = ctx.createLinearGradient(0, 0, 0, h);
            oceanGradient.addColorStop(0, '#1e40af');
            oceanGradient.addColorStop(0.4, '#1e3a8a');
            oceanGradient.addColorStop(0.7, '#1e1b4b');
            oceanGradient.addColorStop(1, '#111827');
            ctx.fillStyle = oceanGradient;
            ctx.fillRect(game.camera.x, game.camera.y, w, h);
            
            // CONTINENTI DETTAGLIATI
            ctx.save();
            ctx.translate(game.camera.x + w*0.5, game.camera.y + h*0.5);
            ctx.scale(w/2.2, h/1.8);
            
            // Nord America
            ctx.fillStyle = '#2d5a2d'; ctx.beginPath();
            ctx.ellipse(0.1, -0.1, 0.22, 0.35, 0, 0, Math.PI*2); ctx.fill();
            
            // Sud America
            ctx.ellipse(0.15, 0.35, 0.18, 0.4, -0.2, 0, Math.PI*2); ctx.fill();
            
            // Europa
            ctx.fillStyle = '#3a7a3a'; ctx.beginPath();
            ctx.ellipse(-0.15, 0.05, 0.18, 0.25, 0.3, 0, Math.PI*2); ctx.fill();
            
            // Africa
            ctx.fillStyle = '#2d5a2d'; ctx.beginPath();
            ctx.ellipse(0.05, 0.35, 0.22, 0.4, 0.1, 0, Math.PI*2); ctx.fill();
            
            // Asia
            ctx.fillStyle = '#3a7a3a'; ctx.beginPath();
            ctx.ellipse(0.35, 0.15, 0.35, 0.35, -0.1, 0, Math.PI*2); ctx.fill();
            
            // Australia
            ctx.fillStyle = '#2d5a2d'; ctx.beginPath();
            ctx.ellipse(0.45, 0.65, 0.12, 0.18, 0.4, 0, Math.PI*2); ctx.fill();
            
            ctx.restore();
        }

        function render() {
            ctx.resetTransform();
            ctx.imageSmoothingEnabled = false;
            
            // MAPPA
            renderWorldMap();
            
            // NAZIONI ALLE POSIZIONI REALI
            Object.entries(game.nations).forEach(([name, data]) => {
                const x = game.camera.x + data.x * canvas.width / game.camera.zoom;
                const y = game.camera.y + data.y * canvas.height / game.camera.zoom;
                const size = data.size * game.camera.zoom;
                
                // Colori diplomazia
                let color = game.diplomacy[name] === 'ally' ? '#00ff88' : 
                           game.diplomacy[name] === 'enemy' ? '#ff4444' : 
                           name === game.playerNation ? '#ffff44' : 
                           name === game.selectedNation ? '#ffaa00' : data.color;
                
                // Glow effect
                const glow = ctx.createRadialGradient(x, y, 0, x, y, size * 1.8);
                glow.addColorStop(0, color);
                glow.addColorStop(0.5, color + 'DD');
                glow.addColorStop(1, color + '00');
                ctx.fillStyle = glow;
                ctx.beginPath();
                ctx.arc(x, y, size * 1.8, 0, Math.PI * 2);
                ctx.fill();
                
                // Nazione principale
                const solid = ctx.createRadialGradient(x, y, 0, x, y, size);
                solid.addColorStop(0, color);
                solid.addColorStop(0.7, color + 'FF');
                solid.addColorStop(1, color + '88');
                ctx.fillStyle = solid;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
                
                // Bordo
                ctx.strokeStyle = name === game.playerNation ? '#ffffff' : 
                                 name === game.selectedNation ? '#ffff00' : '#ffffff66';
                ctx.lineWidth = (name === game.playerNation ? 5 : name === game.selectedNation ? 4 : 2.5) * game.camera.zoom;
                ctx.lineJoin = 'round';
                ctx.shadowColor = color;
                ctx.shadowBlur = 15 * game.camera.zoom;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.stroke();
                ctx.shadowBlur = 0;
                
                // Flag
                ctx.fillStyle = '#000000FF';
                ctx.font = `bold ${Math.max(28, 36 * game.camera.zoom)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(data.flag, x, y);
                
                // Nome abbreviato
                ctx.fillStyle = '#ffffff';
                ctx.font = `bold ${Math.max(16, 20 * game.camera.zoom)}px Arial`;
                ctx.fillText(name.slice(0,3).toUpperCase(), x, y + size + 25 * game.camera.zoom);
                
                // GDP
                ctx.font = `${Math.max(14, 18 * game.camera.zoom)}px Arial`;
                ctx.fillStyle = '#ffffffCC';
                ctx.fillText(`$${Math.floor(data.gdp/100)}B`, x, y + size + 48 * game.camera.zoom);
            });
            
            // HUD Principale
            ctx.fillStyle = 'rgba(0,0,0,0.9)';
            ctx.fillRect(30, 30, 420, 100);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(`${game.playerNation} ${game.nations[game.playerNation].flag}`, 50, 65);
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Anno ${game.year} â€¢ Mese ${game.month}`, 50, 95);
            ctx.font = 'bold 20px Arial';
            const share = (game.player.gdp / game.totalWorldGDP * 100).toFixed(1);
            ctx.fillStyle = share > 50 ? '#00ff88' : share > 20 ? '#f39c12' : '#ffffff';
            ctx.fillText(`Dominio Globale: ${share}%`, 50, 125);
        }

        // MINIMAP
        function renderMinimap() {
            mctx.fillStyle = '#111';
            mctx.fillRect(0, 0, 200, 120);
            renderWorldMapSmall(mctx, 200, 120);
            
            Object.entries(game.nations).slice(0, 15).forEach(([name, data]) => {
                const x = 20 + (Object.keys(game.nations).indexOf(name) % 5) * 35;
                const y = 25 + Math.floor(Object.keys(game.nations).indexOf(name) / 5) * 20;
                const size = Math.max(4, data.size / 8);
                const color = game.diplomacy[name] === 'ally' ? '#00ff88' : name === game.playerNation ? '#ffff44' : data.color;
                
                mctx.fillStyle = color;
                mctx.beginPath();
                mctx.arc(x, y, size, 0, Math.PI * 2);
                mctx.fill();
                
                mctx.fillStyle = '#fff';
                mctx.font = '12px Arial';
                mctx.textAlign = 'center';
                mctx.textBaseline = 'middle';
                mctx.fillText(data.flag, x, y);
            });
        }

        function renderWorldMapSmall(ctx, w, h) {
            const oceanGradient = ctx.createLinearGradient(0, 0, 0, h);
            oceanGradient.addColorStop(0, '#1e40af');
            oceanGradient.addColorStop(1, '#111827');
            ctx.fillStyle = oceanGradient;
            ctx.fillRect(0, 0, w, h);
            
            ctx.fillStyle = '#2d5a2d';
            ctx.fillRect(w*0.1, h*0.1, w*0.25, h*0.3);
            ctx.fillRect(w*0.75, h*0.2, w*0.25, h*0.4);
            ctx.fillRect(w*0.25, h*0.4, w*0.15, h*0.3);
        }

        // INPUT
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / game.camera.zoom - game.camera.x;
            const y = (e.clientY - rect.top) / game.camera.zoom - game.camera.y;
            
            Object.entries(game.nations).forEach(([name, data]) => {
                const nx = data.x * canvas.width / game.camera.zoom;
                const ny = data.y * canvas.height / game.camera.zoom;
                const dist = Math.sqrt((x - nx)**2 + (y - ny)**2);
                if (dist < data.size * 1.5) {
                    game.selectedNation = name;
                    addNews(`${data.flag} <strong>${name}</strong> selezionata (GDP: $${Math.floor(data.gdp).toLocaleString()}B)`);
                }
            });
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const direction = e.deltaY > 0 ? 0.9 : 1.1;
            game.camera.zoom *= direction;
            game.camera.zoom = Math.max(0.5, Math.min(3, game.camera.zoom));
        });

        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case ' ': e.preventDefault(); togglePause(); break;
                case 's': saveGame(); break;
                case 'l': loadGame(); break;
                case 'r': selectNationRandom(); break;
            }
        });

        // SAVE/LOAD
        function saveGame() {
            localStorage.setItem('nationSimPro', JSON.stringify(game));
            addNews('ğŸ’¾ <strong>Partita salvata</strong>');
        }
        function loadGame() {
            try {
                const saved = localStorage.getItem('nationSimPro');
                if (saved) {
                    Object.assign(game, JSON.parse(saved));
                    game.player = game.nations[game.playerNation];
                    updateUI();
                    addNews('ğŸ“‚ <strong>Partita caricata</strong>');
                }
            } catch(e) { addNews('âŒ Errore caricamento'); }
        }

        document.getElementById('winMode').addEventListener('change', (e) => {
            game.winCondition = e.target.value;
        });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // GAME LOOP 60FPS
        let lastTime = 0;
        function gameLoop(time) {
            const delta = time - lastTime;
            if (!game.paused && delta > 1000/60) {
                game.day += game.gameSpeed;
                if (game.day >= 30) {
                    game.month++; game.day = 1;
                    if (game.month > 12) { game.year++; game.month = 1; }
                }
                if (Math.random() < 0.008) randomEvent();
            }
            
            ctx.resetTransform();
            render();
            renderMinimap();
            
            lastTime = time;
            requestAnimationFrame(gameLoop);
        }

        // START
        updateUI();
        addNews('ğŸŒ <strong>Nation President Simulator - MAPPA MONDIALE</strong>');
        addNews('ğŸ® Clicca le nazioni â€¢ Ruota per zoom â€¢ Spazio = Pausa');
        addNews('âš”ï¸ Obiettivo: Dominio globale del 80% GDP mondiale!');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
