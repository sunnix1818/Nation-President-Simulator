<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nation President Simulator - COMPLETO</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e); 
            color:#fff; 
            font-family:'Segoe UI',Arial,sans-serif; 
            overflow:hidden;
        }
        canvas { display:block; cursor: crosshair; }
        #ui { 
            position:absolute; top:15px; left:15px; 
            background: rgba(0,0,0,0.92); padding:25px; border-radius:15px; 
            border: 2px solid #4a90e2; backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(74,144,226,0.3); min-width: 380px;
        }
        #title { 
            color:#4a90e2; font-size:26px; font-weight:bold; text-align:center; 
            margin-bottom:15px; text-shadow: 0 0 15px #4a90e2;
        }
        button { 
            background: linear-gradient(45deg, #4a90e2, #357abd); color:white; 
            border:none; padding:12px 20px; margin:4px; border-radius:8px; 
            cursor:pointer; font-weight:bold; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(74,144,226,0.4);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(74,144,226,0.6); }
        button:active { transform: translateY(0); }
        button.danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        button.success { background: linear-gradient(45deg, #27ae60, #229954); }
        #stats { 
            font-size:16px; line-height:1.6; margin:15px 0;
            background: rgba(255,255,255,0.05); padding:15px; border-radius:8px;
        }
        .stat-bar {
            width:100%; height:10px; background:rgba(255,255,255,0.1); 
            border-radius:5px; margin:5px 0; overflow:hidden;
        }
        .stat-fill { height:100%; transition: width 0.5s; border-radius:5px; }
        #news { 
            position:absolute; bottom:15px; right:15px; 
            width:420px; height:320px; overflow-y:auto; 
            background:rgba(0,0,0,0.92); padding:20px; border-radius:15px;
            border: 2px solid #f39c12; font-size:14px; line-height:1.5;
        }
        .news-item { 
            margin-bottom:12px; padding:12px; 
            background:rgba(243,156,18,0.15); border-radius:8px; 
            border-left: 4px solid #f39c12;
        }
        select { 
            background:#2c3e50; color:white; border:1px solid #4a90e2; 
            padding:10px; border-radius:5px; margin:5px;
        }
        #instructions {
            position:absolute; top:15px; right:15px; 
            background:rgba(0,0,0,0.8); padding:15px; border-radius:10px;
            font-size:12px; max-width:300px; line-height:1.4;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="ui">
        <div id="title">ğŸŒ NATION PRESIDENT SIMULATOR 2026</div>
        <div style="font-size:18px; margin-bottom:10px;">
            ğŸ‡®ğŸ‡¹ <span id="nationName">Italia</span>
        </div>
        
        <div id="stats">
            ğŸ’° <strong>GDP:</strong> $<span id="gdp">2100</span>B 
            <div class="stat-bar"><div id="gdpBar" class="stat-fill" style="background:linear-gradient(90deg,#27ae60,#2ecc71);width:42%"></div></div>
            
            ğŸ‘¥ <strong>Popolazione:</strong> <span id="pop">60</span>M 
            <div class="stat-bar"><div id="popBar" class="stat-fill" style="background:linear-gradient(90deg,#3498db,#5dade2);width:30%"></div></div>
            
            ğŸ‘ <strong>Approvazione:</strong> <span id="approval">58</span>% 
            <div class="stat-bar"><div id="approvalBar" class="stat-fill" style="background:linear-gradient(90deg,#f39c12,#e67e22);width:58%"></div></div>
            
            âš”ï¸ <strong>Militare:</strong> <span id="military">95</span> 
            <div class="stat-bar"><div id="militaryBar" class="stat-fill" style="background:linear-gradient(90deg,#e74c3c,#c0392b);width:19%"></div></div>
            
            ğŸ¤ <strong>Alleanze:</strong> <span id="diplo">0</span> 
            <div class="stat-bar"><div id="diploBar" class="stat-fill" style="background:linear-gradient(90deg,#9b59b6,#8e44ad);width:0%"></div></div>
            
            ğŸ’¸ <strong>Debito:</strong> $<span id="debt">2850</span>B
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:15px 0;">
            <button onclick="selectNationRandom()" style="grid-column:span 2; background:linear-gradient(45deg,#9b59b6,#8e44ad);">
                ğŸ² Nuova Nazione
            </button>
            
            <button onclick="setTaxesLow()">ğŸ’¸ Tasse Basse</button>
            <button onclick="setTaxesHigh()">ğŸ’° Tasse Alte</button>
            
            <button class="success" onclick="buildInfrastructure()">ğŸ—ï¸ Infrastrutture</button>
            <button class="success" onclick="boostTrade()">ğŸŒ Commercio</button>
            
            <button class="danger" onclick="recruitMilitary()">âš”ï¸ Esercito</button>
            <button onclick="makeAlliance()">ğŸ¤ Alleanza</button>
            
            <button class="danger" onclick="declareWar()">ğŸ’¥ Guerra</button>
            <button onclick="randomEvent()">ğŸ² Evento</button>
            
            <button onclick="nextMonth()" style="grid-column:span 2; background:linear-gradient(45deg,#27ae60,#229954);">
                â© Mese Successivo
            </button>
        </div>

        <div>
            <select id="winMode">
                <option>ğŸŒ Dominio Assoluto (80% GDP mondiale)</option>
                <option>ğŸ’ ProsperitÃ  (GDP #1 + 80% approv.)</option>
                <option>â³ Sopravvivenza (2036)</option>
            </select>
        </div>
        <div style="margin-top:10px;">
            <button onclick="saveGame()">ğŸ’¾ Salva</button>
            <button onclick="loadGame()">ğŸ“‚ Carica</button>
            <button onclick="togglePause()">â¸ï¸ Pausa</button>
        </div>
    </div>

    <div id="news"></div>

    <div id="instructions">
        <strong>ğŸ® CONTROLLI:</strong><br>
        ğŸ–±ï¸ <strong>Clic:</strong> Seleziona nazioni<br>
        ğŸ–±ï¸ <strong>Wheel:</strong> Zoom mappa<br>
        âŒ¨ï¸ <strong>SPAZIO:</strong> Pausa<br>
        âŒ¨ï¸ <strong>S:</strong> Salva | <strong>L:</strong> Carica<br>
        <strong>ğŸ¯ Obiettivo:</strong> Dominio mondiale!
    </div>

    <script>
        // INIT CANVAS
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // DATI NAZIONI COMPLETE (20+ con posizioni mappa reale)
        const nationsBase = {
            'Italia':     { pop:60, gdp:2100, mil:95, debt:2850, app:58, color:'#00ff41', flag:'ğŸ‡®ğŸ‡¹', x:0.42, y:0.58, continent:'EU' },
            'USA':        { pop:340, gdp:28500, mil:520, debt:35000, app:48, color:'#ff2222', flag:'ğŸ‡ºğŸ‡¸', x:0.15, y:0.45, continent:'NA' },
            'Cina':       { pop:1410, gdp:19500, mil:450, debt:12000, app:92, color:'#ff8c00', flag:'ğŸ‡¨ğŸ‡³', x:0.88, y:0.48, continent:'AS' },
            'Russia':     { pop:144, gdp:1850, mil:320, debt:650, app:72, color:'#4169e1', flag:'ğŸ‡·ğŸ‡º', x:0.65, y:0.35, continent:'EU' },
            'Germania':   { pop:84, gdp:4400, mil:85, debt:2800, app:62, color:'#ffd700', flag:'ğŸ‡©ğŸ‡ª', x:0.38, y:0.48, continent:'EU' },
            'Francia':    { pop:68, gdp:3100, mil:115, debt:3200, app:54, color:'#ffff00', flag:'ğŸ‡«ğŸ‡·', x:0.36, y:0.55, continent:'EU' },
            'Giappone':   { pop:123, gdp:5200, mil:70, debt:9500, app:68, color:'#ff1493', flag:'ğŸ‡¯ğŸ‡µ', x:0.95, y:0.42, continent:'AS' },
            'UK':         { pop:68, gdp:3400, mil:95, debt:3100, app:52, color:'#8b0000', flag:'ğŸ‡¬ğŸ‡§', x:0.32, y:0.50, continent:'EU' },
            'India':      { pop:1420, gdp:3800, mil:180, debt:2800, app:65, color:'#ff6600', flag:'ğŸ‡®ğŸ‡³', x:0.80, y:0.68, continent:'AS' },
            'Brasile':    { pop:216, gdp:2200, mil:85, debt:1600, app:48, color:'#00ff00', flag:'ğŸ‡§ğŸ‡·', x:0.25, y:0.78, continent:'SA' },
            'Canada':     { pop:40, gdp:2200, mil:45, debt:1800, app:72, color:'#ff0000', flag:'ğŸ‡¨ğŸ‡¦', x:0.12, y:0.35, continent:'NA' },
            'Australia':  { pop:26, gdp:1700, mil:40, debt:900, app:75, color:'#00bfff', flag:'ğŸ‡¦ğŸ‡º', x:0.92, y:0.88, continent:'OC' },
            'CoreaSud':   { pop:52, gdp:1900, mil:75, debt:850, app:78, color:'#00ff88', flag:'ğŸ‡°ğŸ‡·', x:0.90, y:0.47, continent:'AS' },
            'Spagna':     { pop:47, gdp:1600, mil:55, debt:1700, app:55, color:'#ff69b4', flag:'ğŸ‡ªğŸ‡¸', x:0.35, y:0.60, continent:'EU' },
            'Messico':    { pop:130, gdp:1500, mil:65, debt:650, app:45, color:'#32cd32', flag:'ğŸ‡²ğŸ‡½', x:0.20, y:0.55, continent:'NA' },
            'Turchia':    { pop:85, gdp:1200, mil:150, debt:500, app:60, color:'#ff4500', flag:'ğŸ‡¹ğŸ‡·', x:0.50, y:0.52, continent:'AS' },
            'Egitto':     { pop:110, gdp:450, mil:120, debt:200, app:55, color:'#gold', flag:'ğŸ‡ªğŸ‡¬', x:0.55, y:0.65, continent:'AF' },
            'ArabiaSaudita':{ pop:36, gdp:1100, mil:90, debt:300, app:70, color:'#000080', flag:'ğŸ‡¸ğŸ‡¦', x:0.70, y:0.62, continent:'AS' },
            'Svezia':     { pop:10, gdp:650, mil:25, debt:300, app:75, color:'#0000ff', flag:'ğŸ‡¸ğŸ‡ª', x:0.33, y:0.46, continent:'EU' },
            'Olanda':     { pop:18, gdp:1100, mil:30, debt:550, app:68, color:'#ffa500', flag:'ğŸ‡³ğŸ‡±', x:0.37, y:0.51, continent:'EU' }
        };

        // STATO GIOCO
        let game = {
            year: 2026, month: 1, day: 15,
            playerNation: 'Italia',
            nations: JSON.parse(JSON.stringify(nationsBase)),
            player: {...nationsBase['Italia']},
            diplomacy: {},
            alliances: new Set(),
            enemies: new Set(),
            news: [],
            winCondition: 'Dominio Assoluto',
            gameSpeed: 1/30,
            paused: false,
            camera: { x: 0, y: 0, zoom: 1 },
            selectedNation: null,
            totalWorldGDP: 0
        };

        // INIZIALIZZA
        Object.keys(game.nations).forEach(name => {
            game.diplomacy[name] = name === game.playerNation ? 'player' : 'neutral';
            game.totalWorldGDP += game.nations[name].gdp;
        });

        // UPDATE UI
        function updateUI() {
            document.getElementById('nationName').textContent = game.playerNation;
            document.getElementById('gdp').textContent = Math.floor(game.player.gdp).toLocaleString();
            document.getElementById('pop').textContent = Math.floor(game.player.pop).toLocaleString();
            document.getElementById('approval').textContent = Math.floor(game.player.approval);
            document.getElementById('military').textContent = Math.floor(game.player.mil);
            document.getElementById('diplo').textContent = game.alliances.size;
            document.getElementById('debt').textContent = Math.floor(game.player.debt).toLocaleString();
            
            // Barre statistiche
            document.getElementById('gdpBar').style.width = `${Math.min(game.player.gdp/40000*100, 100)}%`;
            document.getElementById('popBar').style.width = `${Math.min(game.player.pop/1500*100, 100)}%`;
            document.getElementById('approvalBar').style.width = `${Math.min(game.player.app, 100)}%`;
            document.getElementById('militaryBar').style.width = `${Math.min(game.player.mil/600*100, 100)}%`;
            document.getElementById('diploBar').style.width = `${Math.min(game.alliances.size/20*100, 100)}%`;
        }

        // FUNZIONI GIOCO
        function selectNationRandom() {
            const choices = Object.keys(game.nations).filter(n => n !== game.playerNation);
            const choice = choices[Math.floor(Math.random() * choices.length)];
            game.playerNation = choice;
            game.player = {...game.nations[choice]};
            game.selectedNation = choice;
            updateUI();
            addNews(`ğŸ‘‘ Nuova presidenza: ${choice} ${game.nations[choice].flag}`);
        }

        function setTaxesLow() { setTaxes(0.25); }
        function setTaxesHigh() { setTaxes(0.65); }
        
        function setTaxes(rate) {
            const oldGDP = game.player.gdp;
            game.player.gdp *= (1 + (rate - 0.4) * 0.18);
            game.player.app += rate < 0.3 ? 10 : rate > 0.6 ? -15 : 0;
            game.player.debt += rate * game.player.gdp * 0.12;
            game.player.app = Math.max(0, Math.min(100, game.player.app));
            addNews(`ğŸ’¸ Tasse ${rate < 0.4 ? 'ridotte' : 'alzate'} (${Math.round(rate*100)}%). GDP: ${Math.floor(oldGDP)}B â†’ ${Math.floor(game.player.gdp)}B`);
        }

        function buildInfrastructure() {
            game.player.gdp += 90 + Math.random() * 50;
            game.player.debt += 160;
            game.player.app += 10;
            addNews('ğŸ—ï¸ Infrastrutture completate! +90-140 GDP, +10% approvazione');
        }

        function boostTrade() {
            const bonus = 60 + game.alliances.size * 15;
            game.player.gdp += bonus;
            game.player.app += 5;
            addNews(`ğŸŒ Commercio globale: +${bonus} GDP (${game.alliances.size} alleati)`);
        }

        function recruitMilitary() {
            const cost = 45 + game.player.mil * 0.15;
            game.player.mil += 30 + Math.random() * 20;
            game.player.gdp -= cost;
            game.player.app -= 5;
            addNews(`âš”ï¸ Reclutamento: +${Math.floor(30 + Math.random() * 20)} truppe (-${Math.floor(cost)} GDP)`);
        }

        function makeAlliance() {
            const targets = Object.keys(game.nations).filter(n => 
                n !== game.playerNation && game.diplomacy[n] === 'neutral'
            );
            if (targets.length === 0) return addNews('âŒ Nessun candidato per alleanze');
            
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'ally';
            game.alliances.add(target);
            game.player.gdp += 30;
            addNews(`ğŸ¤ Alleanza con ${target} ${game.nations[target].flag}! +30 GDP`);
        }

        function declareWar() {
            const targets = Object.keys(game.nations).filter(n => 
                n !== game.playerNation && game.diplomacy[n] !== 'enemy'
            );
            if (targets.length === 0) return addNews('âŒ Nessun nemico disponibile');
            
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'enemy';
            
            const powerRatio = game.player.mil / (game.player.mil + game.nations[target].mil);
            if (Math.random() < powerRatio * 0.75) {
                const loot = game.nations[target].gdp * 0.35;
                game.player.gdp += loot;
                game.nations[target].gdp *= 0.65;
                game.player.mil += 15;
                addNews(`âœ… VITTORIA su ${target}! +${Math.floor(loot)}B GDP conquistato`);
            } else {
                game.player.gdp *= 0.82;
                game.player.mil *= 0.72;
                game.player.app -= 18;
                addNews(`ğŸ’¥ SCONFITTA contro ${target}! Perdite devastanti`);
            }
        }

        function randomEvent() {
            const events = [
                { text: 'ğŸš€ Boom tecnologico! +250 GDP', effect: () => game.player.gdp += 250 },
                { text: 'ğŸŒªï¸ Disastro naturale! -120 GDP', effect: () => game.player.gdp -= 120 },
                { text: 'ğŸ“ˆ Crescita economica! +100 GDP', effect: () => game.player.gdp += 100 },
                { text: 'ğŸ“° Scandalo politico! -20% approvazione', effect: () => game.player.app = Math.max(0, game.player.app - 20) },
                { text: 'ğŸ‘¶ Boom demografico! +3M popolazione', effect: () => game.player.pop += 3 },
                { text: 'ğŸ­ Crisi industriale! -80 GDP', effect: () => game.player.gdp -= 80 },
                { text: 'âš½ Campionato vinto! +15% approvazione', effect: () => game.player.app = Math.min(100, game.player.app + 15) },
                { text: 'ğŸ’¸ Crisi debito! +2500B debito', effect: () => game.player.debt += 2500 },
                { text: 'ğŸ¦  Pandemia! -200 GDP, -10% app', effect: () => { game.player.gdp -= 200; game.player.app -= 10; } },
                { text: 'ğŸ’ Scoperta petrolio! +400 GDP', effect: () => game.player.gdp += 400 }
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            event.effect();
            addNews(event.text);
        }

        function nextMonth() {
            game.month++;
            if (game.month > 12) { 
                game.year++; 
                game.month = 1; 
                game.totalWorldGDP *= 1.025; // Crescita mondiale
                randomEvent();
            }
            updateAI();
            checkVictory();
            updateUI();
            addNews(`ğŸ“… ${game.month}/${game.year} - Turno completato`);
        }

        function updateAI() {
            Object.entries(game.nations).forEach(([name, nation]) => {
                if (name === game.playerNation) return;
                nation.gdp *= 1.012;
                nation.mil *= 1.003;
                nation.pop *= 1.0008;
                nation.app += (Math.random() - 0.5) * 2;
            });
        }

        function checkVictory() {
            const playerShare = game.player.gdp / game.totalWorldGDP;
            const isTopGDP = game.player.gdp === Math.max(...Object.values(game.nations).map(n => n.gdp));
            
            if (game.winCondition.includes('Dominio') && playerShare > 0.8) {
                alert(`ğŸ‰ VITTORIA ASSOLUTA!\nControlli l'80% del GDP mondiale!\nPunteggio finale: ${Math.floor(game.year * 100 + game.month * 10 + game.player.app)}`);
            } else if (game.winCondition.includes('ProsperitÃ ') && isTopGDP && game.player.app > 80) {
                alert(`ğŸ‰ PROSPERITÃ€ GLOBALE!\n#1 GDP mondiale + 80%+ approvazione!\nLeggenda presidenziale!`);
            } else if (game.winCondition.includes('Sopravvivenza') && game.year >= 2036) {
                alert(`ğŸ‰ SOPRAVVISSUTO!\n10 anni di presidenza completati!`);
            }
        }

        function addNews(msg) {
            game.news.unshift(`[${game.year}-${String(game.month).padStart(2,'0')}] ${msg}`);
            if (game.news.length > 12) game.news.pop();
            document.getElementById('news').innerHTML = 
                game.news.map(n => `<div class="news-item">${n}</div>`).join('');
        }

        function togglePause() {
            game.paused = !game.paused;
            addNews(game.paused ? 'â¸ï¸ GIOCO IN PAUSA' : 'â–¶ï¸ GIOCO RIPRESO');
        }

        // RENDER MAPPA
        function render() {
            const w = canvas.width / game.camera.zoom;
            const h = canvas.height / game.camera.zoom;
            
            // SFONDO TERRESTRE
            const oceanGradient = ctx.createLinearGradient(0, 0, 0, h);
            oceanGradient.addColorStop(0, '#1e3a8a');
            oceanGradient.addColorStop(0.5, '#0f172a');
            oceanGradient.addColorStop(1, '#1e1b4b');
            ctx.fillStyle = oceanGradient;
            ctx.fillRect(game.camera.x, game.camera.y, w, h);
            
            // CONTINENTI STILIZZATI
            ctx.fillStyle = '#2d5a2d';
            ctx.fillRect(game.camera.x + w*0.15, game.camera.y + h*0.25, w*0.25, h*0.25); // Nord America
            ctx.fillRect(game.camera.x + w*0.85, game.camera.y + h*0.35, w*0.12, h*0.25); // Asia
            ctx.fillRect(game.camera.x + w*0.35, game.camera.y + h*0.45, w*0.15, h*0.25); // Europa
            ctx.fillRect(game.camera.x + w*0.22, game.camera.y + h*0.70, w*0.12, h*0.20); // Sud America
            ctx.fillRect(game.camera.x + w*0.78, game.camera.y + h*0.60, w*0.18, h*0.15); // India/Indocina
            ctx.fillRect(game.camera.x + w*0.90, game.camera.y + h*0.80, w*0.08, h*0.15); // Australia
            
            // NAZIONI
            Object.entries(game.nations).forEach(([name, data]) => {
                const x = game.camera.x + data.x * w;
                const y = game.camera.y + data.y * h;
                const size = Math.max(25, Math.sqrt(data.gdp / 8)) * game.camera.zoom;
                
                // Colore diplomazia
                let color = game.diplomacy[name] === 'ally' ? '#00ff88' : 
                           game.diplomacy[name] === 'enemy' ? '#ff4444' : 
                           name === game.playerNation ? '#ffff44' : data.color;
                
                // Effetto glow
                const glow = ctx.createRadialGradient(x, y, 0, x, y, size * 1.5);
                glow.addColorStop(0, color);
                glow.addColorStop(0.6, color + 'CC');
                glow.addColorStop(1, color + '00');
                
                ctx.fillStyle = glow;
                ctx.beginPath();
                ctx.arc(x, y, size * 1.5, 0, Math.PI * 2);
                ctx.fill();
                
                // Nazione solida
                const solid = ctx.createRadialGradient(x, y, 0, x, y, size);
                solid.addColorStop(0, color);
                solid.addColorStop(0.8, color + 'DD');
                solid.addColorStop(1, color + '66');
                ctx.fillStyle = solid;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
                
                // Bordo
                ctx.strokeStyle = name === game.playerNation ? '#ffffff' : 
                                 name === game.selectedNation ? '#ffff00' : '#ffffff44';
                ctx.lineWidth = name === game.playerNation ? 4 : 
                               name === game.selectedNation ? 3 : 2;
                ctx.lineJoin = 'round';
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.stroke();
                
                // Testi
                ctx.fillStyle = '#000000EE';
                ctx.font = `bold ${Math.max(20, 24 * game.camera.zoom)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(data.flag, x, y);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(14, 16 * game.camera.zoom)}px Arial`;
                ctx.fillText(name.slice(0,3).toUpperCase(), x, y + size + 20);
                
                ctx.font = `${Math.max(12, 14 * game.camera.zoom)}px Arial`;
                ctx.fillStyle = '#ffffffBB';
                ctx.fillText(`$${Math.floor(data.gdp/100)}B`, x, y + size + 38);
            });
            
            // HUD
            ctx.fillStyle = 'rgba(0,0,0,0.85)';
            ctx.fillRect(25, 25, 380, 85);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(`${game.playerNation} ${game.nations[game.playerNation].flag}`, 40, 55);
            
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`Anno ${game.year} â€¢ Mese ${game.month}`, 40, 82);
            
            const playerShare = (game.player.gdp / game.totalWorldGDP * 100).toFixed(1);
            ctx.fillStyle = playerShare > 50 ? '#00ff88' : playerShare > 20 ? '#f39c12' : '#ffffff';
            ctx.fillText(`Quota GDP: ${playerShare}%`, 40, 110);
        }

        // INPUT
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / game.camera.zoom - game.camera.x;
            const y = (e.clientY - rect.top) / game.camera.zoom - game.camera.y;
            
            Object.entries(game.nations).forEach(([name, data]) => {
                const nx = data.x * canvas.width / game.camera.zoom;
                const ny = data.y * canvas.height / game.camera.zoom;
                const dist = Math.sqrt((x - nx)**2 + (y - ny)**2);
                if (dist < Math.sqrt(data.gdp / 8) * 1.5) {
                    game.selectedNation = name;
                    addNews(`ğŸ¯ ${name} selezionata (GDP: $${Math.floor(data.gdp).toLocaleString()}B)`);
                }
            });
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            game.camera.zoom *= e.deltaY > 0 ? 0.9 : 1.1;
            game.camera.zoom = Math.max(0.4, Math.min(3, game.camera.zoom));
        });

        // TASTI
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    togglePause();
                    break;
                case 's': saveGame(); break;
                case 'l': loadGame(); break;
                case 'r': selectNationRandom(); break;
            }
        });

        // SALVA/CARICA
        function saveGame() {
            localStorage.setItem('nationPresidentSim_v2', JSON.stringify(game));
            addNews('ğŸ’¾ Partita salvata con successo!');
        }

        function loadGame() {
            try {
                const saved = localStorage.getItem('nationPresidentSim_v2');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    Object.assign(game, loaded);
                    game.player = game.nations[game.playerNation];
                    updateUI();
                    addNews('ğŸ“‚ Partita caricata!');
                }
            } catch(e) {
                addNews('âŒ Errore caricamento');
            }
        }

        // EVENT LISTENER
        document.getElementById('winMode').addEventListener('change', (e) => {
            game.winCondition = e.target.value;
        });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // GAME LOOP 60FPS
        let lastTime = 0;
        function gameLoop(currentTime) {
            const deltaTime = currentTime - lastTime;
            
            if (!game.paused && deltaTime > 1000/60) {
                game.day += game.gameSpeed;
                if (game.day >= 30) {
                    game.month++;
                    game.day = 1;
                    if (game.month > 12) {
                        game.year++;
                        game.month = 1;
                    }
                }
                
                // Auto-eventi rari
                if (Math.random() < 0.005) randomEvent();
            }
            
            ctx.save();
            ctx.scale(game.camera.zoom, game.camera.zoom);
            ctx.translate(game.camera.x, game.camera.y);
            render();
            ctx.restore();
            
            lastTime = currentTime;
            requestAnimationFrame(gameLoop);
        }

        // AVVIO
        updateUI();
        addNews('ğŸš€ Nation President Simulator avviato!');
        addNews('ğŸ¯ Clicca sulle nazioni per selezionarle');
        addNews('âš”ï¸ Usa diplomazia, economia e militare per dominare il mondo!');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
