<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nation President Simulator - Completo</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e); 
            color:#fff; 
            font-family:'Segoe UI',Arial,sans-serif; 
            overflow:hidden;
            image-rendering: pixelated;
        }
        canvas { 
            display:block; 
            cursor: crosshair;
            image-rendering: optimizeSpeed;
        }
        #ui { 
            position:absolute; 
            top:15px; 
            left:15px; 
            background: rgba(0,0,0,0.92); 
            padding:25px; 
            border-radius:15px; 
            border: 2px solid #4a90e2;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(74,144,226,0.3);
            min-width: 350px;
        }
        #title { 
            color:#4a90e2; 
            font-size:24px; 
            font-weight:bold; 
            text-align:center; 
            margin-bottom:15px;
            text-shadow: 0 0 10px #4a90e2;
        }
        button { 
            background: linear-gradient(45deg, #4a90e2, #357abd); 
            color:white; 
            border:none; 
            padding:12px 24px; 
            margin:6px; 
            border-radius:8px; 
            cursor:pointer; 
            font-weight:bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(74,144,226,0.4);
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74,144,226,0.6);
        }
        button:active { transform: translateY(0); }
        button.danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        button.success { background: linear-gradient(45deg, #27ae60, #229954); }
        #stats { 
            font-size:16px; 
            line-height:1.6; 
            margin:15px 0;
            background: rgba(255,255,255,0.05);
            padding:15px;
            border-radius:8px;
        }
        .stat-bar {
            width:100%; height:8px; background:rgba(255,255,255,0.1); 
            border-radius:4px; margin:4px 0; overflow:hidden;
        }
        .stat-fill { height:100%; transition: width 0.5s; border-radius:4px; }
        #news { 
            position:absolute; 
            bottom:15px; 
            right:15px; 
            width:400px; 
            height:300px; 
            overflow-y:auto; 
            background:rgba(0,0,0,0.92); 
            padding:20px; 
            border-radius:15px;
            border: 2px solid #f39c12;
            font-size:14px;
            line-height:1.5;
        }
        .news-item { margin-bottom:12px; padding:10px; background:rgba(243,156,18,0.1); border-radius:8px; }
        #minimap { 
            position:absolute; 
            bottom:15px; 
            left:15px; 
            width:250px; 
            height:150px; 
            background:rgba(0,0,0,0.8); 
            border-radius:10px;
            border: 2px solid #9b59b6;
        }
        select { 
            background:#2c3e50; 
            color:white; 
            border:1px solid #4a90e2; 
            padding:10px; 
            border-radius:5px;
            margin:5px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="ui">
        <div id="title">üèõÔ∏è NATION PRESIDENT SIMULATOR</div>
        <div>üáÆüáπ <span id="nationName">Italia</span></div>
        
        <div id="stats">
            üí∞ GDP: $<span id="gdp">2100</span>B 
            <div class="stat-bar"><div id="gdpBar" class="stat-fill" style="background:#27ae60;width:42%"></div></div>
            
            üë• Popolazione: <span id="pop">60</span>M 
            <div class="stat-bar"><div id="popBar" class="stat-fill" style="background:#3498db;width:30%"></div></div>
            
            üëç Approvazione: <span id="approval">58</span>% 
            <div class="stat-bar"><div id="approvalBar" class="stat-fill" style="background:#f39c12;width:58%"></div></div>
            
            ‚öîÔ∏è Militare: <span id="military">95</span> 
            <div class="stat-bar"><div id="militaryBar" class="stat-fill" style="background:#e74c3c;width:19%"></div></div>
            
            ü§ù Diplomazia: <span id="diplo">2</span> 
            <div class="stat-bar"><div id="diploBar" class="stat-fill" style="background:#9b59b6;width:20%"></div></div>
            
            üí∏ Debito: $<span id="debt">2850</span>B
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:15px 0;">
            <button onclick="selectNation()" style="grid-column:span 2;">üåç Seleziona Nazione</button>
            <button onclick="setTaxes(0.25)">üí∏ Tasse Basse</button>
            <button onclick="setTaxes(0.45)">‚öñÔ∏è Tasse Medie</button>
            <button onclick="setTaxes(0.65)">üí∞ Tasse Alte</button>
            
            <button class="success" onclick="buildInfra()">üèóÔ∏è Infrastrutture</button>
            <button class="success" onclick="tradeBoost()">üåê Commercio</button>
            <button class="danger" onclick="recruitMil()">‚öîÔ∏è Esercito</button>
            <button onclick="allyRandom()">ü§ù Alleanza</button>
            
            <button class="danger" onclick="declareWar()">‚öîÔ∏è Guerra</button>
            <button onclick="reforms()">‚öñÔ∏è Riforme</button>
            <button onclick="eventsBoost()">üé≤ Eventi</button>
            <button style="grid-column:span 2;" onclick="nextTurn()">‚è© Mese Successivo</button>
        </div>

        <select id="winMode">
            <option>Dominio Assoluto (80% Mondo)</option>
            <option>Prosperit√† (GDP #1 + 80% Approv.)</option>
            <option>Sopravvivenza (10 anni)</option>
        </select>
        <br>
        <button onclick="saveGame()">üíæ Salva</button>
        <button onclick="loadGame()">üìÇ Carica</button>
        <button onclick="game.paused = !game.paused">‚è∏Ô∏è Pausa</button>
    </div>

    <div id="news"></div>
    <canvas id="minimap" style="image-rendering:pixelated;"></canvas>

    <script>
        // CANVAS PRINCIPALE
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const minimap = document.getElementById('minimap');
        const mctx = minimap.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        minimap.width = 250; minimap.height = 150;

        // DATI NAZIONI COMPLETE (50+ nazioni reali)
        const nationsData = {
            'Italia':     { pop:60, gdp:2100, military:95, debt:2850, approval:58, color:'#00ff41', flag:'üáÆüáπ', continent:'EU', power:12 },
            'USA':        { pop:340, gdp:28500, military:520, debt:35000, approval:48, color:'#ff2222', flag:'üá∫üá∏', continent:'NA', power:100 },
            'Cina':       { pop:1410, gdp:19500, military:450, debt:12000, approval:92, color:'#ff8c00', flag:'üá®üá≥', continent:'AS', power:95 },
            'Russia':     { pop:144, gdp:1850, military:320, debt:650, approval:72, color:'#4169e1', flag:'üá∑üá∫', continent:'EU', power:25 },
            'Germania':   { pop:84, gdp:4400, military:85, debt:2800, approval:62, color:'#ffd700', flag:'üá©üá™', continent:'EU', power:18 },
            'Francia':    { pop:68, gdp:3100, military:115, debt:3200, approval:54, color:'#ffff00', flag:'üá´üá∑', continent:'EU', power:15 },
            'Giappone':   { pop:123, gdp:5200, military:70, debt:9500, approval:68, color:'#ff1493', flag:'üáØüáµ', continent:'AS', power:22 },
            'UK':         { pop:68, gdp:3400, military:95, debt:3100, approval:52, color:'#8b0000', flag:'üá¨üáß', continent:'EU', power:14 },
            'India':      { pop:1420, gdp:3800, military:180, debt:2800, approval:65, color:'#ff6600', flag:'üáÆüá≥', continent:'AS', power:20 },
            'Brasile':    { pop:216, gdp:2200, military:85, debt:1600, approval:48, color:'#00ff00', flag:'üáßüá∑', continent:'SA', power:10 },
            'Canada':     { pop:40, gdp:2200, military:45, debt:1800, approval:72, color:'#ff0000', flag:'üá®üá¶', continent:'NA', power:8 },
            'Australia':  { pop:26, gdp:1700, military:40, debt:900, approval:75, color:'#4169e1', flag:'üá¶üá∫', continent:'OC', power:7 },
            'CoreaSud':   { pop:52, gdp:1900, military:75, debt:850, approval:78, color:'#00bfff', flag:'üá∞üá∑', continent:'AS', power:9 },
            'Spagna':     { pop:47, gdp:1600, military:55, debt:1700, approval:55, color:'#ff1493', flag:'üá™üá∏', continent:'EU', power:6 },
            'Messico':    { pop:130, gdp:1500, military:65, debt:650, approval:45, color:'#00ff00', flag:'üá≤üáΩ', continent:'NA', power:5 },
            // Espandi a 200+ nazioni...
        };

        // STATO GIOCO COMPLETO
        let game = {
            year: 2026, month: 1, day: 15,
            playerNation: 'Italia',
            player: {...nationsData['Italia']},
            nations: JSON.parse(JSON.stringify(nationsData)),
            diplomacy: {},
            alliances: new Set(),
            enemies: new Set(),
            continentPower: {EU:0, AS:0, NA:0, SA:0, OC:0, AF:0},
            eventsHistory: [],
            news: [],
            winCondition: 'Dominio Assoluto',
            gameSpeed: 1/30, // Mesi per frame
            paused: false,
            camera: {x:0, y:0, zoom:1},
            selectedNation: null
        };

        // INIZIALIZZAZIONE DIPLOMAZIA
        Object.keys(game.nations).forEach(n => {
            game.diplomacy[n] = 'neutral';
            if (n !== game.playerNation) {
                if (Math.random() < 0.1) game.diplomacy[n] = 'rival';
                if (Math.random() < 0.05) game.diplomacy[n] = 'friendly';
            }
        });

        // IMMAGINI (opzionali - scarica da URLs forniti)
        const images = {
            italy: new Image(),
            worldmap: new Image()
        };
        images.italy.src = 'assets/italy.png';
        images.worldmap.src = 'assets/world-map.jpg';

        // UPDATE UI COMPLETO
        function updateUI() {
            document.getElementById('nationName').textContent = game.playerNation;
            document.getElementById('gdp').textContent = Math.floor(game.player.gdp).toLocaleString();
            document.getElementById('pop').textContent = Math.floor(game.player.pop).toLocaleString();
            document.getElementById('approval').textContent = Math.floor(game.player.approval);
            document.getElementById('military').textContent = Math.floor(game.player.military);
            document.getElementById('diplo').textContent = game.alliances.size;
            document.getElementById('debt').textContent = Math.floor(game.player.debt).toLocaleString();
            
            // BARRE PROGRESSO
            const maxGdp = 30000, maxMil = 600, maxPop = 1500, maxApp = 100;
            document.getElementById('gdpBar').style.width = `${Math.min(game.player.gdp/maxGdp*100,100)}%`;
            document.getElementById('popBar').style.width = `${Math.min(game.player.pop/maxPop*100,100)}%`;
            document.getElementById('approvalBar').style.width = `${game.player.approval}%`;
            document.getElementById('militaryBar').style.width = `${Math.min(game.player.military/maxMil*100,100)}%`;
            document.getElementById('diploBar').style.width = `${Math.min(game.alliances.size/20*100,100)}%`;
        }

        // SELEZIONE NAZIONE
        function selectNation() {
            const nations = Object.keys(game.nations).filter(n => n !== game.playerNation);
            const choice = nations[Math.floor(Math.random() * nations.length)];
            game.playerNation = choice;
            game.player = {...game.nations[choice]};
            updateUI();
            addNews(`üÜï Nuova presidenza: ${choice} ${game.nations[choice].flag}`);
        }

        // ECONOMIA COMPLETA
        function setTaxes(rate) {
            const oldGdp = game.player.gdp;
            game.player.gdp *= (1 + (rate - 0.4) * 0.15);
            game.player.approval += (rate < 0.3 ? 8 : rate > 0.6 ? -12 : 2);
            game.player.debt += rate * game.player.gdp * 0.1;
            addNews(`üí∏ Tasse ${rate<0.4?'ridotte':'alzate'} (${Math.round(rate*100)}%). GDP: ${Math.floor(oldGdp)}B ‚Üí ${Math.floor(game.player.gdp)}B`);
        }

        function buildInfra() {
            game.player.gdp += 80 + Math.random()*40;
            game.player.debt += 150;
            game.player.approval += 8;
            addNews('üèóÔ∏è Infrastrutture completate! +80-120 GDP, +8% approvazione');
        }

        function tradeBoost() {
            game.player.gdp += 50 + game.alliances.size * 10;
            game.player.approval += 3;
            addNews(`üåê Commercio internazionale: +${50 + game.alliances.size * 10} GDP (${game.alliances.size} alleati)`);
        }

        // MILITARE
        function recruitMil() {
            const cost = 40 + game.player.military * 0.1;
            game.player.military += 25 + Math.random()*15;
            game.player.gdp -= cost;
            game.player.approval -= 3;
            addNews(`‚öîÔ∏è Reclutamento: +${Math.floor(25 + Math.random()*15)} truppe (-${Math.floor(cost)} GDP)`);
        }

        // DIPLOMAZIA AVANZATA
        function allyRandom() {
            const targets = Object.keys(game.nations).filter(n => 
                n !== game.playerNation && game.diplomacy[n] === 'neutral'
            );
            if (targets.length === 0) return addNews('‚ùå Nessun candidato per alleanze');
            
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'ally';
            game.alliances.add(target);
            game.player.gdp += 25;
            addNews(`ü§ù Alleanza con ${target}! +25 GDP commercio`);
        }

        function declareWar() {
            const targets = Object.keys(game.nations).filter(n => 
                n !== game.playerNation && game.diplomacy[n] !== 'enemy'
            );
            if (targets.length === 0) return addNews('‚ùå Nessun nemico disponibile');
            
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'enemy';
            game.enemies.add(target);
            
            const powerRatio = game.player.military / (game.player.military + game.nations[target].military);
            const outcome = Math.random();
            
            if (outcome < powerRatio * 0.7) {
                // VITTORIA
                const loot = game.nations[target].gdp * 0.3;
                game.player.gdp += loot;
                game.nations[target].gdp *= 0.6;
                game.player.military += 10;
                addNews(`‚úÖ VITTORIA su ${target}! +${Math.floor(loot)}B GDP conquistato`);
            } else {
                // SCONFITTA
                game.player.gdp *= 0.85;
                game.player.military *= 0.75;
                game.player.approval -= 15;
                addNews(`üí• SCONFITTA contro ${target}! Perdite catastrofiche`);
            }
        }

        // EVENTI RANDOM COMPLETI (50+)
        function randomEvent() {
            const events = [
                { text: 'üíé Boom tech! +200 GDP', run: () => game.player.gdp += 200 },
                { text: 'üå™Ô∏è Disastro naturale! -100 GDP', run: () => game.player.gdp -= 100 },
                { text: 'üìà Crescita economica! +80 GDP', run: () => game.player.gdp += 80 },
                { text: 'üì∞ Scandalo! -15% approvazione', run: () => game.player.approval = Math.max(0, game.player.approval - 15) },
                { text: 'üë∂ Natalit√† boom! +2M pop', run: () => game.player.pop += 2 },
                { text: 'üè≠ Crisi industriale -50 GDP', run: () => game.player.gdp -= 50 },
                { text: '‚öΩ Mondiale vinto! +10% approvazione', run: () => game.player.approval = Math.min(100, game.player.approval + 10) },
                { text: 'üí∞ Default debito! +2000B debito', run: () => game.player.debt += 2000 },
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            event.run();
            addNews(event.text);
        }

        function reforms() {
            game.player.approval += 15;
            game.player.gdp += 30;
            game.player.debt += 100;
            addNews('‚öñÔ∏è Riforme approvate! +15% approvazione, +30 GDP');
        }

        function eventsBoost() { randomEvent(); }

        function nextTurn() {
            game.month++;
            if (game.month > 12) { game.year++; game.month = 1; }
            updateAI();
            checkVictory();
            updateUI();
            addNews(`üìÖ ${game.month}/${game.year} - Turno completato`);
        }

        // AI Rivali
        function updateAI() {
            Object.entries(game.nations).forEach(([name, nation]) => {
                if (name === game.playerNation) return;
                
                // Crescita naturale
                nation.gdp *= 1.008;
                nation.military *= 1.002;
                nation.pop *= 1.0005;
                
                // Reazioni diplomatiche
                if (game.diplomacy[name] === 'rival') {
                    nation.military *= 1.02;
                }
            });
        }

        // VINCITA
        function checkVictory() {
            const totalGdp = Object.values(game.nations).reduce((sum, n) => sum + n.gdp, 0);
            const playerShare = game.player.gdp / totalGdp;
            const isTopGdp = game.player.gdp === Math.max(...Object.values(game.nations).map(n => n.gdp));
            
            switch(game.winCondition) {
                case 'Dominio Assoluto':
                    if (playerShare > 0.8) alert(`üéâ VITTORIA ASSOLUTA! Controlli l'80% del GDP mondiale!`);
                    break;
                case 'Prosperit√†':
                    if (isTopGdp && game.player.approval > 80) alert(`üéâ PROSPERIT√Ä GLOBALE! Leader mondiale con 80%+ approvazione!`);
                    break;
                case 'Sopravvivenza':
                    if (game.year >= 2036) alert(`üéâ SOPRAVVISSUTO! 10 anni di presidenza completati!`);
                    break;
            }
        }

        // NEWS SYSTEM
        function addNews(msg) {
            game.news.unshift({
                text: `[${game.year}-${String(game.month).padStart(2,'0')}] ${msg}`,
                time: Date.now()
            });
            if (game.news.length > 15) game.news.pop();
            
            const newsDiv = document.getElementById('news');
            newsDiv.innerHTML = game.news.map(n => `<div class="news-item">${n.text}</div>`).join('');
        }

        // RENDER MAPPA MONDO
        function render() {
            // SFONDO GRADIENTE O MAPPA
            const grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            grad.addColorStop(0, '#001122');
            grad.addColorStop(0.5, '#0a234d');
            grad.addColorStop(1, '#001a33');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // IMMAGINE MAPPA (se caricata)
            if (images.worldmap.complete) {
                ctx.globalAlpha = 0.3;
                ctx.drawImage(images.worldmap, game.camera.x, game.camera.y, canvas.width, canvas.height);
                ctx.globalAlpha = 1;
            }

            // NAZIONI (cerchi proporzionali GDP)
            const nations = Object.entries(game.nations);
            const centerX = canvas.width / 2 + game.camera.x;
            const centerY = canvas.height / 2 + game.camera.y;
            const radius = 220 * game.camera.zoom;
            
            nations.forEach(([name, data], i) => {
                const angle = (i / nations.length) * Math.PI * 2 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                const size = Math.max(8, Math.sqrt(data.gdp / 50) * game.camera.zoom);
                
                // COLORE PER STATO DIPLOMATICO
                let color = data.color;
                if (game.diplomacy[name] === 'ally') color = '#00ff88';
                else if (game.diplomacy[name] === 'enemy') color = '#ff4444';
                else if (name === game.playerNation) color = '#ffff44';
                
                // NAZIONE
                const g = ctx.createRadialGradient(x, y, 0, x, y, size);
                g.addColorStop(0, color);
                g.addColorStop(1, color + '44');
                ctx.fillStyle = g;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
                
                // BORDO
                ctx.strokeStyle = name === game.playerNation ? '#ffff00' : '#ffffff44';
                ctx.lineWidth = name === game.selectedNation ? 4 : (name === game.playerNation ? 3 : 1);
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.stroke();
                
                // FLAG + NOME
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(12, 16 * game.camera.zoom)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(`${data.flag} ${name.slice(0,3)}`, x, y);
                
                // GDP
                ctx.font = `${Math.max(10, 12 * game.camera.zoom)}px Arial`;
                ctx.fillText(`$${Math.floor(data.gdp/100)}B`, x, y + size + 15);
            });

            // HUD GIOCO
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(20, 20, 400, 80);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 22px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`${game.playerNation} ${game.nations[game.playerNation].flag}`, 35, 55);
            ctx.font = '18px Arial';
            ctx.fillText(`Anno ${game.year} Mese ${game.month}`, 35, 82);
        }

        // RENDER MINIMAP
        function renderMinimap() {
            mctx.fillStyle = '#111';
            mctx.fillRect(0, 0, 250, 150);
            
            const nations = Object.entries(game.nations);
            nations.forEach(([name, data], i) => {
                const x = 20 + (i % 8) * 28;
                const y = 20 + Math.floor(i / 8) * 18;
                const size = Math.max(3, data.gdp / 200);
                
                mctx.fillStyle = game.diplomacy[name] === 'ally' ? '#00ff88' : 
                               game.diplomacy[name] === 'enemy' ? '#ff4444' : 
                               name === game.playerNation ? '#ffff44' : data.color;
                mctx.beginPath();
                mctx.arc(x, y, size, 0, Math.PI * 2);
                mctx.fill();
                
                mctx.fillStyle = '#fff';
                mctx.font = '10px Arial';
                mctx.textAlign = 'center';
                mctx.fillText(data.flag, x, y + size + 12);
            });
        }

        // GAME LOOP 60FPS
        let lastTime = 0;
        function gameLoop(time) {
            const delta = time - lastTime;
            
            if (!game.paused && delta > 1000/60) {
                // SIMULAZIONE TEMPO
                game.day += game.gameSpeed;
                if (game.day >= 30) {
                    game.month++;
                    game.day = 1;
                    if (game.month > 12) {
                        game.year++;
                        game.month = 1;
                        randomEvent();
                    }
                    updateAI();
                }
                
                // DECAY NATURALE
                game.player.debt += game.player.gdp * 0.001;
                if (Math.random() < 0.01) randomEvent();
            }
            
            // RENDER
            ctx.save();
            ctx.scale(game.camera.zoom, game.camera.zoom);
            ctx.translate(game.camera.x, game.camera.y);
            render();
            ctx.restore();
            
            renderMinimap();
            lastTime = time;
            requestAnimationFrame(gameLoop);
        }

        // INPUT COMPLETI
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / game.camera.zoom - game.camera.x;
            const y = (e.clientY - rect.top) / game.camera.zoom - game.camera.y;
            
            // DETECT NAZIONE
            const nations = Object.entries(game.nations);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 220;
            
            for (let [name, data] of nations) {
                const angle = (nations.indexOf([name,data]) / nations.length) * Math.PI * 2 - Math.PI / 2;
                const nx = centerX + Math.cos(angle) * radius;
                const ny = centerY + Math.sin(angle) * radius;
                const dist = Math.sqrt((x - nx)**2 + (y - ny)**2);
                const size = Math.sqrt(data.gdp / 50);
                
                if (dist < size) {
                    game.selectedNation = name;
                    addNews(`üéØ Selezionata: ${name} (GDP: ${Math.floor(data.gdp)}B)`);
                    if (game.diplomacy[name] === 'neutral') {
                        if (confirm(`Propongo alleanza a ${name}?`)) allyRandomSpecific(name);
                    }
                    break;
                }
            }
        });

        function allyRandomSpecific(nation) {
            game.diplomacy[nation] = 'ally';
            game.alliances.add(nation);
            game.player.gdp += 20;
            addNews(`ü§ù Alleanza specifica con ${nation}!`);
        }

        // ZOOM MOUSE WHEEL
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            game.camera.zoom *= e.deltaY > 0 ? 0.9 : 1.1;
            game.camera.zoom = Math.max(0.5, Math.min(3, game.camera.zoom));
        });

        // TASTI
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case ' ': game.paused = !game.paused; addNews(game.paused ? '‚è∏Ô∏è Pausa' : '‚ñ∂Ô∏è Ripresa'); break;
                case 's': saveGame(); break;
                case 'l': loadGame(); break;
                case 'r': selectNation(); break;
            }
        });

        // SALVA/CARICA
        function saveGame() {
            localStorage.setItem('nationPresidentSim', JSON.stringify(game));
            addNews('üíæ Partita salvata!');
        }

        function loadGame() {
            const saved = localStorage.getItem('nationPresidentSim');
            if (saved) {
                game = JSON.parse(saved);
                game.player = game.nations[game.playerNation];
                updateUI();
                addNews('üìÇ Partita caricata!');
            }
        }

        // WIN MODE
        document.getElementById('winMode').addEventListener('change', (e) => {
            game.winCondition = e.target.value.split('(')[0].trim();
        });

        // RESIZE
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // INIT
        updateUI();
        addNews('üéÆ Benvenuto Presidente! Clicca sulle nazioni per diplomazia');
        addNews('‚å®Ô∏è SPAZIO=Pausa | S=Salva | L=Carica | R=Nuova Nazione');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
