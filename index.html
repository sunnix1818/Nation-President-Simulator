<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nation President Simulator - GUERRE + CAPITALI + PUPPET</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { 
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e); 
            color:#fff; font-family:'Segoe UI',Arial,sans-serif; overflow:hidden;
        }
        canvas { display:block; cursor: crosshair; }
        #ui { 
            position:absolute; top:15px; left:15px; 
            background: rgba(0,0,0,0.97); padding:30px; border-radius:25px; 
            border: 3px solid #4a90e2; backdrop-filter: blur(20px);
            box-shadow: 0 15px 50px rgba(74,144,226,0.5); min-width: 480px; max-height: 90vh; overflow-y:auto;
        }
        #title { 
            color:#4a90e2; font-size:32px; font-weight:bold; text-align:center; 
            margin-bottom:20px; text-shadow: 0 0 25px #4a90e2; letter-spacing: 3px;
        }
        button { 
            background: linear-gradient(45deg, #4a90e2, #357abd); color:white; 
            border:none; padding:16px 24px; margin:6px; border-radius:12px; 
            cursor:pointer; font-weight:bold; transition: all 0.3s; font-size:15px;
            box-shadow: 0 6px 25px rgba(74,144,226,0.5);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(74,144,226,0.7); }
        button.danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        button.success { background: linear-gradient(45deg, #27ae60, #229954); }
        button.warning { background: linear-gradient(45deg, #f39c12, #e67e22); }
        button.puppet { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        #stats { 
            font-size:18px; line-height:1.8; margin:20px 0; background: rgba(255,255,255,0.1); 
            padding:25px; border-radius:15px; border: 2px solid rgba(74,144,226,0.4);
        }
        .stat-bar { width:100%; height:14px; background:rgba(255,255,255,0.15); border-radius:7px; margin:8px 0; overflow:hidden; }
        .stat-fill { height:100%; transition: width 0.8s cubic-bezier(0.4,0,0.2,1); border-radius:7px; box-shadow: 0 0 10px currentColor; }
        #news { 
            position:absolute; bottom:20px; right:20px; width:500px; height:380px; 
            overflow-y:auto; background:rgba(0,0,0,0.97); padding:30px; border-radius:25px;
            border: 4px solid #f39c12; font-size:16px; line-height:1.7;
        }
        .news-item { margin-bottom:18px; padding:18px; background:rgba(243,156,18,0.25); border-radius:15px; border-left: 6px solid #f39c12; }
        .news-victory { background: rgba(46,204,113,0.5) !important; border-left-color: #27ae60 !important; animation: pulse 1s infinite; }
        .news-war { background: rgba(231,76,60,0.4) !important; border-left-color: #e74c3c !important; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.7} }
        #conquest-panel { display:none; background:rgba(155,89,182,0.95); padding:20px; border-radius:15px; margin:15px 0; }
        #minimap { position:absolute; bottom:20px; left:20px; width:220px; height:140px; background:rgba(0,0,0,0.9); border-radius:20px; border:3px solid #9b59b6; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <canvas id="minimap"></canvas>
    
    <div id="ui">
        <div id="title">âš”ï¸ NATION CONQUEST SIMULATOR 2026</div>
        <div style="font-size:22px; margin-bottom:15px; text-align:center;">
            <span id="flag">ğŸ‡®ğŸ‡¹</span> <strong id="nationName">Italia</strong>
        </div>
        
        <div id="stats">
            ğŸ’° <strong>GDP:</strong> $<span id="gdp">2100</span>B 
            <div class="stat-bar"><div id="gdpBar" class="stat-fill" style="background:linear-gradient(90deg,#27ae60,#2ecc71);width:35%"></div></div>
            
            ğŸ‘¥ <strong>Popolazione:</strong> <span id="pop">60</span>M 
            <div class="stat-bar"><div id="popBar" class="stat-fill" style="background:linear-gradient(90deg,#3498db,#5dade2);width:25%"></div></div>
            
            ğŸ‘ <strong>Approvazione:</strong> <span id="approval">58</span>% 
            <div class="stat-bar"><div id="approvalBar" class="stat-fill" style="background:linear-gradient(90deg,#f39c12,#e67e22);width:58%"></div></div>
            
            âš”ï¸ <strong>Esercito:</strong> <span id="military">95</span> 
            <div class="stat-bar"><div id="militaryBar" class="stat-fill" style="background:linear-gradient(90deg,#e74c3c,#c0392b);width:16%"></div></div>
            
            ğŸ° <strong>CittÃ :</strong> <span id="cities">12</span>/<span id="totalCities">45</span> 
            <div class="stat-bar"><div id="citiesBar" class="stat-fill" style="background:linear-gradient(90deg,#9b59b6,#8e44ad);width:27%"></div></div>
            
            ğŸ¤ <strong>Alleanze:</strong> <span id="diplo">0</span> 
            <div class="stat-bar"><div id="diploBar" class="stat-fill" style="background:linear-gradient(90deg,#f39c12,#e67e22);width:0%"></div></div>
            
            ğŸ’¸ <strong>Debito:</strong> $<span id="debt">2850</span>B
            <div style="font-size:14px; color:#00ff88; margin-top:15px;">
                ğŸŒ <strong>Dominio:</strong> <span id="worldShare">4.2</span>% | ğŸ–ï¸ <span id="rank">8Â°</span> posto
            </div>
        </div>

        <div id="conquest-panel">
            <h3>ğŸ° <span id="targetNation"></span> - Capitale Conquistata!</h3>
            <button class="success" onclick="annexNation()">ğŸ‡®ğŸ‡¹ <strong>ANNETTERE</strong> (GDP +100%)</button>
            <button class="puppet" onclick="makePuppet()">ğŸ¤ <strong>PUPPET STATE</strong> (GDP +30%, esercito tuo)</button>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:25px 0;">
            <button onclick="selectNationRandom()" style="grid-column:span 2; background:linear-gradient(45deg,#9b59b6,#8e44ad)">
                ğŸ² Nuova Nazione
            </button>
            
            <button onclick="setTaxesLow()">ğŸ’¸ Tasse Basse</button>
            <button onclick="setTaxesHigh()">ğŸ’° Tasse Alte</button>
            
            <button class="success" onclick="buildInfrastructure()">ğŸ—ï¸ Infrastrutture</button>
            <button class="success" onclick="boostTrade()">ğŸŒ Commercio</button>
            
            <button class="danger" onclick="recruitMilitary()">âš”ï¸ Recluta Truppe</button>
            <button class="warning" onclick="sendAttack()">ğŸš€ Lancia Attacco</button>
            
            <button onclick="makeAlliance()">ğŸ¤ Alleanza</button>
            <button onclick="randomEvent()">ğŸ² Evento</button>
            
            <button onclick="nextMonth()" style="grid-column:span 2; background:linear-gradient(45deg,#27ae60,#229954); font-size:18px">
                â© PROSSIMO MESE
            </button>
        </div>

        <select id="winMode" style="width:100%; margin:15px 0;">
            <option>ğŸŒ Impero Mondiale (90% GDP)</option>
            <option>âš”ï¸ Conquistatore (80% cittÃ )</option>
            <option>ğŸ’ Superpotenza (GDP #1 + 90% app)</option>
        </select>
        
        <div style="text-align:center; font-size:14px;">
            <button onclick="saveGame()">ğŸ’¾ Salva</button>
            <button onclick="loadGame()">ğŸ“‚ Carica</button>
            <button onclick="togglePause()" id="pauseBtn">â¸ï¸ Pausa</button>
        </div>
    </div>

    <div id="news"></div>

    <script>
        // CANVAS
        const canvas = document.getElementById('canvas');
        const minimap = document.getElementById('minimap');
        const ctx = canvas.getContext('2d');
        const mctx = minimap.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        minimap.width = 220; minimap.height = 140;

        // NAZIONI CON CAPITALI E CITTÃ€ âœ…
        const nationsData = {
            'USA': { flag:'ğŸ‡ºğŸ‡¸', color:'#ff2222', x:0.18, y:0.42, gdp:28500, mil:520, pop:340, app:48, debt:35000, 
                     capital:'Washington', capitalX:0.19, capitalY:0.44, cities:50, controlled:0, citiesList:['NY','LA','Chicago'] },
            'Italia': { flag:'ğŸ‡®ğŸ‡¹', color:'#00ff41', x:0.42, y:0.58, gdp:2100, mil:95, pop:60, app:58, debt:2850, 
                        capital:'Roma', capitalX:0.43, capitalY:0.60, cities:45, controlled:12, citiesList:['Milano','Napoli','Torino'] },
            'Germania': { flag:'ğŸ‡©ğŸ‡ª', color:'#ffd700', x:0.38, y:0.48, gdp:4400, mil:85, pop:84, app:62, debt:2800, 
                          capital:'Berlino', capitalX:0.39, capitalY:0.47, cities:35, controlled:0, citiesList:['Monaco','Amburgo'] },
            'Francia': { flag:'ğŸ‡«ğŸ‡·', color:'#ffff00', x:0.34, y:0.54, gdp:3100, mil:115, pop:68, app:54, debt:3200, 
                         capital:'Parigi', capitalX:0.35, y:0.53, cities:38, controlled:0, citiesList:['Marsiglia','Lione'] },
            'UK': { flag:'ğŸ‡¬ğŸ‡§', color:'#8b0000', x:0.28, y:0.48, gdp:3400, mil:95, pop:68, app:52, debt:3100, 
                    capital:'Londra', capitalX:0.29, y:0.47, cities:25, controlled:0, citiesList:['Manchester'] },
            'Cina': { flag:'ğŸ‡¨ğŸ‡³', color:'#ff8c00', x:0.88, y:0.52, gdp:19500, mil:450, pop:1410, app:92, debt:12000, 
                      capital:'Pechino', capitalX:0.89, capitalY:0.50, cities:120, controlled:0, citiesList:['Shanghai'] },
            'Russia': { flag:'ğŸ‡·ğŸ‡º', color:'#4169e1', x:0.65, y:0.35, gdp:1850, mil:320, pop:144, app:72, debt:650, 
                        capital:'Mosca', capitalX:0.62, capitalY:0.38, cities:60, controlled:0, citiesList:['SanPietroburgo'] },
            'Giappone': { flag:'ğŸ‡¯ğŸ‡µ', color:'#ff1493', x:0.95, y:0.42, gdp:5200, mil:70, pop:123, app:68, debt:9500, 
                          capital:'Tokyo', capitalX:0.95, capitalY:0.43, cities:40, controlled:0, citiesList:['Osaka'] },
            'India': { flag:'ğŸ‡®ğŸ‡³', color:'#ff6600', x:0.82, y:0.68, gdp:3800, mil:180, pop:1420, app:65, debt:2800, 
                       capital:'NewDelhi', capitalX:0.81, capitalY:0.66, cities:80, controlled:0, citiesList:['Mumbai'] },
            'Brasile': { flag:'ğŸ‡§ğŸ‡·', color:'#00ff00', x:0.28, y:0.75, gdp:2200, mil:85, pop:216, app:48, debt:1600, 
                         capital:'Brasilia', capitalX:0.29, capitalY:0.74, cities:35, controlled:0, citiesList:['Rio'] }
        };

        // STATO GIOCO AVANZATO
        let game = {
            year: 2026, month: 1, day: 15,
            playerNation: 'Italia',
            nations: JSON.parse(JSON.stringify(nationsData)),
            player: {...nationsData['Italia']},
            diplomacy: {},
            alliances: new Set(), enemies: new Set(), puppets: new Set(),
            troops: [], attacks: [], conquestTarget: null,
            news: [], winCondition: 'Impero Mondiale', gameSpeed: 1/30,
            paused: false, camera: {x:0, y:0, zoom:1.3}, totalWorldGDP: 0,
            totalCities: 0, controlledCities: 0
        };

        // INIT
        Object.keys(game.nations).forEach(name => {
            game.diplomacy[name] = name === game.playerNation ? 'player' : 'neutral';
            game.totalWorldGDP += game.nations[name].gdp;
            game.totalCities += game.nations[name].cities;
        });
        game.controlledCities = game.nations[game.playerNation].controlled;

        // TRUPPE ANIMAZIONI
        class Troop {
            constructor(fromX, fromY, targetX, targetY, targetNation) {
                this.x = fromX; this.y = fromY;
                this.targetX = targetX; this.targetY = targetY;
                this.targetNation = targetNation;
                this.progress = 0; this.speed = 0.02 + Math.random() * 0.01;
                this.size = 4 + Math.random() * 3;
                this.trail = [];
            }
            update() {
                this.progress += this.speed;
                if (this.progress >= 1) {
                    this.attackTarget();
                    return false;
                }
                this.x = this.x + (this.targetX - this.x) * this.speed * 2;
                this.y = this.y + (this.targetY - this.y) * this.speed * 2;
                this.trail.push({x:this.x, y:this.y});
                if (this.trail.length > 10) this.trail.shift();
                return true;
            }
            attackTarget() {
                const nation = game.nations[this.targetNation];
                if (Math.random() < 0.6) {
                    nation.controlled++;
                    if (nation.controlled >= nation.cities * 0.8) {
                        game.conquestTarget = this.targetNation;
                        document.getElementById('conquest-panel').style.display = 'block';
                        document.getElementById('targetNation').textContent = this.targetNation;
                    }
                    addNews(`ğŸ° <strong>Truppa conquista cittÃ  di ${this.targetNation}!</strong> (${nation.controlled}/${nation.cities})`, 'victory');
                }
            }
            draw(ctx) {
                // Scia
                for (let i = 0; i < this.trail.length; i++) {
                    ctx.fillStyle = `rgba(255,255,0,${0.3 * (i/this.trail.length)})`;
                    ctx.beginPath();
                    ctx.arc(this.trail[i].x, this.trail[i].y, this.size * 0.5, 0, Math.PI*2);
                    ctx.fill();
                }
                // Truppa principale
                ctx.fillStyle = '#ffff00';
                ctx.shadowColor = '#ffff00'; ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // UI UPDATE
        function updateUI() {
            const playerNation = game.nations[game.playerNation];
            document.getElementById('nationName').textContent = game.playerNation;
            document.getElementById('flag').textContent = playerNation.flag;
            document.getElementById('gdp').textContent = Math.floor(playerNation.gdp).toLocaleString();
            document.getElementById('pop').textContent = Math.floor(playerNation.pop);
            document.getElementById('approval').textContent = Math.floor(playerNation.app);
            document.getElementById('military').textContent = Math.floor(playerNation.mil);
            document.getElementById('cities').textContent = playerNation.controlled;
            document.getElementById('totalCities').textContent = playerNation.cities;
            document.getElementById('diplo').textContent = game.alliances.size + game.puppets.size;
            document.getElementById('debt').textContent = Math.floor(playerNation.debt).toLocaleString();
            document.getElementById('worldShare').textContent = (playerNation.gdp/game.totalWorldGDP*100).toFixed(1);
            
            // Ranking
            const ranking = Object.entries(game.nations).sort((a,b) => b[1].gdp - a[1].gdp);
            const rank = ranking.findIndex(([n]) => n === game.playerNation) + 1;
            document.getElementById('rank').textContent = `${rank}Â°`;
            
            // Stat bars
            ['gdp','pop','approval','military'].forEach(stat => {
                const bar = document.getElementById(stat + 'Bar');
                const value = playerNation[stat === 'approval' ? 'app' : stat];
                const max = stat === 'gdp' ? 50000 : stat === 'pop' ? 1500 : stat === 'approval' ? 100 : 600;
                bar.style.width = `${Math.min(value/max*100, 100)}%`;
            });
            document.getElementById('citiesBar').style.width = `${Math.min(playerNation.controlled/playerNation.cities*100, 100)}%`;
            document.getElementById('diploBar').style.width = `${Math.min((game.alliances.size + game.puppets.size)/10*100, 100)}%`;
        }

        // FUNZIONI PRINCIPALI
        function sendAttack() {
            if (game.player.mil < 20) return addNews('âŒ <strong>Esercito insufficiente!</strong> Servono 20+ truppe');
            const targets = Object.keys(game.nations).filter(n => n !== game.playerNation && game.diplomacy[n] !== 'ally');
            if (!targets.length) return addNews('âŒ <strong>Nessun bersaglio disponibile</strong>');
            
            const target = targets[Math.floor(Math.random() * targets.length)];
            game.diplomacy[target] = 'enemy';
            game.player.mil -= 15;
            
            // Lancia 5 truppe animate
            const px = game.nations[game.playerNation].x * canvas.width;
            const py = game.nations[game.playerNation].y * canvas.height;
            const tx = game.nations[target].x * canvas.width;
            const ty = game.nations[target].y * canvas.height;
            
            for (let i = 0; i < 5; i++) {
                game.troops.push(new Troop(px + (Math.random()-0.5)*100, py + (Math.random()-0.5)*100, tx, ty, target));
            }
            addNews(`ğŸš€ <strong>5 truppe lanciate su ${target}!</strong> -15 esercito`, 'war');
        }

        function annexNation() {
            const target = game.conquestTarget;
            if (!target) return;
            const nation = game.nations[target];
            game.player.gdp += nation.gdp * 1.2;
            game.player.pop += nation.pop * 0.3;
            game.player.mil += nation.mil * 0.5;
            nation.gdp *= 0.1; // Devastata
            document.getElementById('conquest-panel').style.display = 'none';
            game.conquestTarget = null;
            addNews(`ğŸ‡®ğŸ‡¹ <strong>${target.toUpperCase()} ANNESSA!</strong> +${Math.floor(nation.gdp*1.2)}B GDP`, 'victory');
        }

        function makePuppet() {
            const target = game.conquestTarget;
            if (!target) return;
            const nation = game.nations[target];
            game.player.gdp += nation.gdp * 0.35;
            game.player.mil += nation.mil * 0.8;
            game.puppets.add(target);
            nation.gdp *= 0.3;
            nation.mil = 10; // Controllato
            document.getElementById('conquest-panel').style.display = 'none';
            game.conquestTarget = null;
            addNews(`ğŸ¤ <strong>${target.toUpperCase()} PUPPET STATE!</strong> +${Math.floor(nation.gdp*0.35)}B GDP + esercito`, 'victory');
        }

        // Altre funzioni (recruitMilitary, makeAlliance, etc.) identiche al codice precedente...
        function recruitMilitary() {
            const cost = 25 + game.player.mil * 0.1;
            game.player.mil += 30;
            game.player.gdp -= cost;
            game.player.app -= 3;
            addNews(`âš”ï¸ +30 truppe reclutate (-${Math.floor(cost)} GDP)`);
        }

        function makeAlliance() {
            const targets = Object.keys(game.nations).filter(n => n !== game.playerNation && game.diplomacy[n] === 'neutral');
            if (targets.length) {
                const target = targets[Math.floor(Math.random() * targets.length)];
                game.diplomacy[target] = 'ally';
                game.alliances.add(target);
                game.player.gdp += 35;
                addNews(`ğŸ¤ Alleanza con ${target}`);
            }
        }

        function randomEvent() {
            const events = [
                {text: 'ğŸ’ <strong>Scoperta risorse!</strong> +400 GDP', effect: ()=>game.player.gdp += 400},
                {text: 'ğŸŒªï¸ <strong>Disastro naturale!</strong> -200 GDP', effect: ()=>game.player.gdp -= 200},
                {text: 'âš½ <strong>Mondiale vinto!</strong> +20% app', effect: ()=>game.player.app = Math.min(100, game.player.app + 20)}
            ];
            const ev = events[Math.floor(Math.random()*events.length)];
            ev.effect();
            addNews(ev.text);
        }

        function nextMonth() {
            game.month++; if(game.month>12){game.year++;game.month=1;}
            game.troops = game.troops.filter(troop => troop.update());
            updateUI();
            addNews(`ğŸ“… Mese ${game.month}/${game.year}`);
        }

        // RENDER COMPLETO CON ANIMAZIONI
        function render() {
            const w = canvas.width / game.camera.zoom;
            const h = canvas.height / game.camera.zoom;
            
            // OCEANO
            const grad = ctx.createLinearGradient(game.camera.x, game.camera.y, game.camera.x+w, game.camera.y+h);
            grad.addColorStop(0,'#1e40af'); grad.addColorStop(1,'#111827');
            ctx.fillStyle = grad; ctx.fillRect(game.camera.x, game.camera.y, w, h);
            
            // CONTINENTI
            ctx.fillStyle = '#2e7d2e';
            ctx.fillRect(game.camera.x+w*0.12, game.camera.y+h*0.28, w*0.28, h*0.35); // America
            ctx.fillRect(game.camera.x+w*0.85, game.camera.y+h*0.35, w*0.15, h*0.4);  // Asia
            ctx.fillRect(game.camera.x+w*0.30, game.camera.y+h*0.45, w*0.18, h*0.28); // Europa
            
            // NAZIONI + CAPITALI
            Object.entries(game.nations).forEach(([name,data]) => {
                const x = game.camera.x + data.x * w;
                const y = game.camera.y + data.y * h;
                const size = Math.max(30, data.size * game.camera.zoom);
                const capX = game.camera.x + data.capitalX * w;
                const capY = game.camera.y + data.capitalY * h;
                
                // Nazione
                let color = game.diplomacy[name]==='ally' ? '#00ff88' : name===game.playerNation ? '#ffff44' : data.color;
                const glow = ctx.createRadialGradient(x,y,0,x,y,size*2);
                glow.addColorStop(0,color); glow.addColorStop(1,color+'00');
                ctx.fillStyle = glow; ctx.beginPath(); ctx.arc(x,y,size*2,0,Math.PI*2); ctx.fill();
                
                // Capitale (cerchio piccolo)
                const capProgress = data.controlled / data.cities;
                ctx.fillStyle = capProgress > 0.8 ? '#ff4444' : '#ffffff';
                ctx.beginPath(); ctx.arc(capX,capY,8*game.camera.zoom,0,Math.PI*2); ctx.fill();
                
                // Flag nazione
                ctx.fillStyle = '#000'; ctx.font = `bold ${40*game.camera.zoom}px Arial`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(data.flag, x, y);
            });
            
            // TRUPPE ANIMATED
            game.troops.forEach(troop => troop.draw(ctx));
            
            // HUD
            ctx.fillStyle = 'rgba(0,0,0,0.95)'; ctx.fillRect(40,40,450,120);
            ctx.fillStyle = '#fff'; ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
            ctx.fillText(`${game.playerNation} ${game.nations[game.playerNation].flag}`, 60, 80);
            ctx.font = 'bold 26px Arial';
            ctx.fillText(`Anno ${game.year} â€¢ Dominio: ${(game.nations[game.playerNation].gdp/game.totalWorldGDP*100).toFixed(1)}%`, 60, 115);
        }

        // GAME LOOP
        let lastTime = 0;
        function gameLoop(time) {
            if(time - lastTime > 1000/60) {
                if(!game.paused) {
                    game.day += game.gameSpeed;
                    if(game.day >= 30) { game.month++; game.day=1; if(game.month>12){game.year++;game.month=1;} }
                }
                render();
                lastTime = time;
            }
            requestAnimationFrame(gameLoop);
        }

        // EVENTI
        canvas.addEventListener('click', e => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left)/game.camera.zoom - game.camera.x;
            const y = (e.clientY - rect.top)/game.camera.zoom - game.camera.y;
            
            Object.entries(game.nations).forEach(([name,data]) => {
                const nx = data.x * canvas.width/game.camera.zoom;
                const ny = data.y * canvas.height/game.camera.zoom;
                if(Math.sqrt((x-nx)**2 + (y-ny)**2) < data.size*1.5) {
                    game.selectedNation = name;
                    addNews(`${data.flag} ${name} selezionata`);
                }
            });
        });

        canvas.addEventListener('wheel', e => {
            e.preventDefault();
            game.camera.zoom *= e.deltaY > 0 ? 0.9 : 1.1;
            game.camera.zoom = Math.max(0.5, Math.min(3, game.camera.zoom));
        });

        document.addEventListener('keydown', e => {
            if(e.key===' ') { e.preventDefault(); togglePause(); }
            if(e.key.toLowerCase()==='s') saveGame();
        });

        function togglePause() { game.paused = !game.paused; updateUI(); }

        // START
        updateUI();
        addNews('ğŸš€ <strong>CONQUEST MODE ATTIVO!</strong> Lancia truppe, conquista capitali!');
        addNews('âš”ï¸ <strong>Click "Lancia Attacco" â†’ Guarda animazioni truppe â†’ Conquista 80% cittÃ  â†’ PANEL conquista!');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
