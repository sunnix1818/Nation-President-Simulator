<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Nation Conquest â€“ World Map</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#020617;color:white;font-family:Arial}
canvas{display:block}
#ui{
position:absolute;top:20px;left:20px;
background:rgba(0,0,0,.9);
padding:15px;border-radius:12px;
border:2px solid #38bdf8;width:320px
}
button{width:100%;margin-top:6px;padding:8px;
background:#38bdf8;border:none;border-radius:8px;
color:black;font-weight:bold;cursor:pointer}
#news{
position:absolute;bottom:20px;right:20px;
width:420px;height:280px;overflow:auto;
background:rgba(0,0,0,.85);
padding:12px;border-radius:12px;
border:2px solid orange
}
.news-item{margin-bottom:8px;padding:8px;
background:rgba(255,255,255,.1);border-left:5px solid orange}
.news-war{border-left-color:red}
.news-victory{border-left-color:#00ff88}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="ui">
<h3 id="nation">ğŸ‡®ğŸ‡¹ Italia</h3>
<p>âš”ï¸ Esercito: <span id="mil"></span></p>
<p>ğŸ° Territori: <span id="terr"></span></p>
<button onclick="attack()">ğŸš€ Attacca territorio</button>
</div>

<div id="news"></div>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
resize(); window.onresize=resize;
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}

function addNews(t,type=""){
const d=document.createElement("div");
d.className="news-item "+(type?`news-${type}`:"");
d.innerHTML=t;
document.getElementById("news").prepend(d);
}

// =================== MAPPA ===================
const territories={
"ITA_N":{name:"Nord Italia",nation:"Italia",x:.46,y:.48,capital:false,adj:["FRA_S","ITA_C"]},
"ITA_C":{name:"Roma",nation:"Italia",x:.47,y:.53,capital:true,adj:["ITA_N","ITA_S"]},
"ITA_S":{name:"Sud Italia",nation:"Italia",x:.48,y:.58,capital:false,adj:["ITA_C"]},

"FRA_S":{name:"Sud Francia",nation:"Francia",x:.42,y:.50,capital:false,adj:["ITA_N","FRA_C"]},
"FRA_C":{name:"Parigi",nation:"Francia",x:.40,y:.46,capital:true,adj:["FRA_S"]},

"GER":{name:"Berlino",nation:"Germania",x:.44,y:.44,capital:true,adj:["FRA_C"]}
};

const nations={
Italia:{flag:"ğŸ‡®ğŸ‡¹",mil:90,owned:["ITA_N","ITA_C","ITA_S"]},
Francia:{flag:"ğŸ‡«ğŸ‡·",mil:100,owned:["FRA_S","FRA_C"]},
Germania:{flag:"ğŸ‡©ğŸ‡ª",mil:85,owned:["GER"]}
};

let player="Italia";

// =================== LOGICA ===================
function ownsTerritory(n,t){return nations[n].owned.includes(t);}

function attack(){
const my=nations[player];
const possible=Object.entries(territories).filter(([id,t])=>
t.nation!==player &&
t.adj.some(a=>ownsTerritory(player,a))
);

if(!possible.length){
addNews("âŒ Nessun territorio confinante","war");
return;
}

const [id,target]=possible[Math.floor(Math.random()*possible.length)];
const enemy=nations[target.nation];

my.mil-=10;
if(Math.random()<0.65){
my.owned.push(id);
enemy.owned=enemy.owned.filter(t=>t!==id);
addNews(`ğŸ° Conquistato ${target.name}`,"victory");

if(target.capital){
addNews(`ğŸ‘‘ Capitale presa! ${target.nation} ANNESSA`,"victory");
enemy.owned.forEach(t=>my.owned.push(t));
enemy.owned=[];
}
}else{
addNews(`âŒ Attacco fallito su ${target.name}`,"war");
}
updateUI();
}

// =================== UI ===================
function updateUI(){
document.getElementById("nation").innerHTML=
nations[player].flag+" "+player;
document.getElementById("mil").textContent=
nations[player].mil;
document.getElementById("terr").textContent=
nations[player].owned.length;
}
updateUI();

// =================== RENDER ===================
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

// oceano
ctx.fillStyle="#1e3a8a";
ctx.fillRect(0,0,canvas.width,canvas.height);

// europa (forma reale semplificata)
ctx.fillStyle="#14532d";
ctx.beginPath();
ctx.moveTo(canvas.width*.35,canvas.height*.38);
ctx.lineTo(canvas.width*.55,canvas.height*.38);
ctx.lineTo(canvas.width*.55,canvas.height*.65);
ctx.lineTo(canvas.width*.35,canvas.height*.65);
ctx.closePath();
ctx.fill();

// confini
ctx.strokeStyle="#000";
Object.values(territories).forEach(t=>{
const x=t.x*canvas.width;
const y=t.y*canvas.height;
t.adj.forEach(a=>{
const o=territories[a];
ctx.beginPath();
ctx.moveTo(x,y);
ctx.lineTo(o.x*canvas.width,o.y*canvas.height);
ctx.stroke();
});
});

// territori
Object.entries(territories).forEach(([id,t])=>{
const x=t.x*canvas.width;
const y=t.y*canvas.height;
const owner=Object.keys(nations).find(n=>ownsTerritory(n,id));
ctx.fillStyle=owner===player?"#22c55e":"#ef4444";
ctx.beginPath();
ctx.arc(x,y,t.capital?10:7,0,Math.PI*2);
ctx.fill();
ctx.fillStyle="white";
ctx.font="14px Arial";
ctx.textAlign="center";
ctx.fillText(t.capital?"ğŸ›ï¸":"",x,y-12);
});
}

function loop(){
draw();
requestAnimationFrame(loop);
}
loop();

addNews("ğŸŒ Mappa reale attiva â€“ conquista per confini!");
</script>
</body>
</html>
